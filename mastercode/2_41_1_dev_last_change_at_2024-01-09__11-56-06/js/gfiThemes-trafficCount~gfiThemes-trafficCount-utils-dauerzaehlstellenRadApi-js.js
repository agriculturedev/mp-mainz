(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{4024:function(b,z,Y){(function(W){var v=Object.create,m=Object.defineProperty,w=Object.getOwnPropertyDescriptor,k=Object.getOwnPropertyNames,d=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty,_=(g,t)=>{for(var r in t)m(g,r,{get:t[r],enumerable:!0})},c=(g,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of k(t))!M.call(g,i)&&i!==r&&m(g,i,{get:()=>t[i],enumerable:!(a=w(t,i))||a.enumerable});return g},l=(g,t,r)=>(r=g!=null?v(d(g)):{},c(t||!g||!g.__esModule?m(r,"default",{value:g,enumerable:!0}):r,g)),A=g=>c(m({},"__esModule",{value:!0}),g),x={};_(x,{DauerzaehlstellenRadApi:()=>E}),b.exports=A(x);var o=l(Y(53)),T=l(Y(4902)),j=Y(4215),O=l(Y(4192)),R=l(Y(4206));o.default.extend(O.default),o.default.extend(R.default);class E{constructor(t,r,a){const i=t.getProperties().link_download,e=(0,T.default)(i);this.waitingListForCallLinkDownload=[],this.feature=t,this.offsetOfCsvDataYear=-88e3,this.offsetOfCsvDataWeek=-17600,this.offsetOfCsvDataDay=-360,this.gurlittMomentsYear=[],this.gurlittMomentsWeek=[],this.gurlittMomentsDay=[],this.featureExists()&&typeof a=="function"?a(e,n=>{const s=this.parseCSVData(n,";");for(this.gurlittMomentsDay=this.createGurlittMomentDataDay(s),this.gurlittMomentsWeek=this.createGurlittMomentDataWeek(s),this.gurlittMomentsYear=this.createGurlittMomentDataYear(s);this.waitingListForCallLinkDownload.length;){const f=this.waitingListForCallLinkDownload.shift();typeof f=="function"&&f()}},n=>{console.warn("error",n)}):typeof r=="function"&&r("DauerzaehlstellenRadApi.constructor: the feature to use has an unexpected structure or the callLinkDownload function is missing",this.feature)}featureExists(){return typeof this.feature=="object"&&this.feature!==null&&typeof this.feature.getProperties=="function"&&typeof this.feature.getId=="function"}getThingId(t){return this.featureExists()?this.feature.getId():(typeof t=="function"&&t("DauerzaehlstellenRadApi.getThingId: the feature to use has an unexpected structure",this.feature),!1)}getMeansOfTransport(){return"Anzahl_Fahrraeder"}updateTitle(t,r,a,i,e){typeof i=="function"&&i(),this.featureExists()?t===this.getThingId()?r(this.feature.getProperties().name):typeof a=="function"&&a("DauerzaehlstellenRadApi.updateTitle: the given thingId is not the one received by the api via api.getThingId()",t):typeof a=="function"&&a("DauerzaehlstellenRadApi.updateTitle: the feature to use has an unexpected structure",this.feature),typeof e=="function"&&e()}updateDirection(t,r,a,i,e){typeof i=="function"&&i(),t===this.getThingId()?r(W.t("additional:modules.tools.gfi.themes.trafficCount.directionBoth")):typeof a=="function"&&a("DauerzaehlstellenRadApi.updateDirection: the given thingId is not the one received by the api via api.getThingId()",t),typeof e=="function"&&e()}updateDay(t,r,a,i,e,n,s){if(typeof n=="function"&&n(),!this.featureExists())typeof e=="function"&&e("DauerzaehlstellenRadApi.updateDay: the feature to use has an unexpected structure",this.feature);else if(t!==this.getThingId())typeof e=="function"&&e("DauerzaehlstellenRadApi.updateDay: the given thingId is not the one received by the api via api.getThingId()",t);else if(typeof this.feature.getProperties().radfahrende_vortag!="string")typeof e=="function"&&e("DauerzaehlstellenRadApi.updateDay: the feature property radfahrende_vortag is missing or was ill received",this.feature.getProperties().radfahrende_vortag);else{const f=this.feature.getProperties().radfahrende_vortag.split("|");i((0,o.default)(f[0],"DD.MM.YYYY").format("YYYY-MM-DD"),parseInt(f[1],10))}typeof s=="function"&&s()}updateYear(t,r,a,i,e,n,s,f){const p=f||(0,o.default)().format("YYYY");if(typeof n=="function"&&n(),!this.featureExists())typeof e=="function"&&e("DauerzaehlstellenRadApi.updateYear: the feature to use has an unexpected structure",this.feature);else if(t!==this.getThingId())typeof e=="function"&&e("DauerzaehlstellenRadApi.updateYear: the given thingId is not the one received by the api via api.getThingId()",t);else if(typeof this.feature.getProperties().radfahrende_vorjahr!="string")typeof e=="function"&&e("DauerzaehlstellenRadApi.updateYear: the feature property radfahrende_vorjahr is missing or was ill received",this.feature.getProperties().radfahrende_vorjahr);else if(typeof this.feature.getProperties().radfahrende_seit_jahresbeginn!="string")typeof e=="function"&&e("DauerzaehlstellenRadApi.updateYear: the feature property radfahrende_seit_jahresbeginn is missing or was ill received",this.feature.getProperties().radfahrende_seit_jahresbeginn);else if(a===p){const u=this.feature.getProperties().radfahrende_seit_jahresbeginn.split("|");i((0,o.default)(u[0],"DD.MM.YYYY").format("YYYY"),parseInt(u[1],10))}else{const u=this.feature.getProperties().radfahrende_vorjahr.split("|");i(u[0],parseInt(u[1],10))}typeof s=="function"&&s()}updateTotal(t,r,a,i,e,n){if(typeof e=="function"&&e(),!this.featureExists())typeof i=="function"&&i("DauerzaehlstellenRadApi.updateTotal: the feature to use has an unexpected structure",this.feature);else if(t!==this.getThingId())typeof i=="function"&&i("DauerzaehlstellenRadApi.updateTotal: the given thingId is not the one received by the api via api.getThingId()",t);else if(typeof this.feature.getProperties().radfahrende_insgesamt!="string")typeof i=="function"&&i("DauerzaehlstellenRadApi.updateTotal: the feature property radfahrende_insgesamt is missing or was ill received",this.feature.getProperties().radfahrende_insgesamt);else{const s=this.feature.getProperties().radfahrende_insgesamt.split("|");a((0,o.default)(s[0],"DD.MM.YYYY").format("YYYY-MM-DD"),parseInt(s[1],10))}typeof n=="function"&&n()}updateWorkingDayAverage(t,r,a,i,e,n,s,f){if(!this.gurlittMomentsYear.length&&!this.gurlittMomentsWeek.length&&!this.gurlittMomentsDay.length){this.waitingListForCallLinkDownload.push(()=>{this.updateWorkingDayAverage(t,r,a,i,e,n,s,f)});return}const p=this.gurlittMomentsWeek.slice(Math.abs(a)*-1);let u=0,y=0,h=null;typeof s=="function"&&s(),p.forEach(D=>{if(typeof D!="object"||D===null||!(D.momentStart instanceof o.default))return;const P=(0,j.getPublicHoliday)(D.momentStart,i),H=D.momentStart.isoWeekday();h===null&&(h=D.momentStart),!(P||H===6||H===7)&&(u+=typeof D?.result=="number"?D.result:0,y++)}),typeof e=="function"&&e(h?h.format("YYYY-MM-DD"):"",y!==0?Math.round(u/y):0),typeof f=="function"&&f()}updateHighestWorkloadDay(t,r,a,i,e,n,s){if(typeof n=="function"&&n(),!this.featureExists())typeof e=="function"&&e("DauerzaehlstellenRadApi.updateHighestWorkloadDay: the feature to use has an unexpected structure",this.feature);else if(t!==this.getThingId())typeof e=="function"&&e("DauerzaehlstellenRadApi.updateHighestWorkloadDay: the given thingId is not the one received by the api via api.getThingId()",t);else if(typeof this.feature.getProperties().max_radfahrende_tag_jahr!="string")typeof e=="function"&&e("DauerzaehlstellenRadApi.updateHighestWorkloadDay: the feature property max_radfahrende_tag_jahr is missing or was ill received",this.feature.getProperties().max_radfahrende_tag_jahr);else{const f=this.feature.getProperties().max_radfahrende_tag_jahr.split("|");i((0,o.default)(f[0],"DD.MM.YYYY").format("YYYY-MM-DD"),parseInt(f[1],10))}typeof s=="function"&&s()}updateHighestWorkloadWeek(t,r,a,i,e,n,s){if(typeof n=="function"&&n(),!this.featureExists())typeof e=="function"&&e("DauerzaehlstellenRadApi.updateHighestWorkloadWeek: the feature to use has an unexpected structure",this.feature);else if(t!==this.getThingId())typeof e=="function"&&e("DauerzaehlstellenRadApi.updateHighestWorkloadWeek: the given thingId is not the one received by the api via api.getThingId()",t);else if(typeof this.feature.getProperties().max_radfahrende_woche_jahr!="string")typeof e=="function"&&e("DauerzaehlstellenRadApi.updateHighestWorkloadWeek: the feature property max_radfahrende_woche_jahr is missing or was ill received",this.feature.getProperties().max_radfahrende_woche_jahr);else{const f=this.feature.getProperties().max_radfahrende_woche_jahr.split("|");i(f[0],parseInt(f[1],10))}typeof s=="function"&&s()}updateHighestWorkloadMonth(t,r,a,i,e,n,s){if(typeof n=="function"&&n(),!this.featureExists())typeof e=="function"&&e("DauerzaehlstellenRadApi.updateHighestWorkloadMonth: the feature to use has an unexpected structure",this.feature);else if(t!==this.getThingId())typeof e=="function"&&e("DauerzaehlstellenRadApi.updateHighestWorkloadMonth: the given thingId is not the one received by the api via api.getThingId()",t);else if(typeof this.feature.getProperties().max_radfahrende_monat_jahr!="string")typeof e=="function"&&e("DauerzaehlstellenRadApi.updateHighestWorkloadMonth: the feature property max_radfahrende_monat_jahr is missing or was ill received",this.feature.getProperties().max_radfahrende_monat_jahr);else{const f=this.feature.getProperties().max_radfahrende_monat_jahr.split("|");i(f[0],parseInt(f[1],10))}typeof s=="function"&&s()}updateDataset(t,r,a,i,e,n,s){const f=[],p=Array.isArray(a)?a:[a];if(!this.gurlittMomentsYear.length&&!this.gurlittMomentsWeek.length&&!this.gurlittMomentsDay.length){this.waitingListForCallLinkDownload.push(()=>{this.updateDataset(t,r,a,i,e,n,s)});return}typeof n=="function"&&n(),t!==this.getThingId()?typeof e=="function"&&e("DauerzaehlstellenRadApi.updateDataset: the given thingId is not the one received by the api via api.getThingId()",t):(p.forEach(u=>{const y={};y[r]={},typeof u!="object"||u===null||typeof u.interval!="string"||typeof u.from!="string"||typeof u.until!="string"?typeof e=="function"&&e("DauerzaehlstellenRadApi.updateDataset: the given timeSettings contain a timeSet with an unexpected format",a):u.interval==="15-Min"?this.gurlittMomentsDay.forEach(h=>{h.momentStart.format("YYYY-MM-DD")===u.from&&(y[r][h.momentStart.format("YYYY-MM-DD HH:mm:ss")]=h.result)}):u.interval==="1-Tag"?this.gurlittMomentsWeek.forEach(h=>{(0,o.default)(h.momentStart).startOf("isoWeek").format("YYYY-MM-DD")===u.from&&(y[r][h.momentStart.format("YYYY-MM-DD HH:mm:ss")]=h.result)}):u.interval==="1-Woche"?this.gurlittMomentsYear.forEach(h=>{((0,o.default)(h.momentStart).startOf("year").subtract(3,"day").format("YYYY-MM-DD")===u.from||(0,o.default)(h.momentEnd).format("YYYY-MM-DD")===u.until)&&(y[r][h.momentStart.format("YYYY-MM-DD HH:mm:ss")]=h.result)}):typeof e=="function"&&e("DauerzaehlstellenRadApi.updateDataset: unexpected interval",u),f.push(y)}),i(f)),typeof s=="function"&&s()}subscribeLastUpdate(t,r,a,i,e,n){if(!this.gurlittMomentsYear.length&&!this.gurlittMomentsWeek.length&&!this.gurlittMomentsDay.length){this.waitingListForCallLinkDownload.push(()=>{this.subscribeLastUpdate(t,r,a,i,e,n)});return}if(typeof e=="function"&&e(),t!==this.getThingId())typeof i=="function"&&i("DauerzaehlstellenRadApi.subscribeLastUpdate: the given thingId is not the one received by the api via api.getThingId()",t);else if(!Array.isArray(this.gurlittMomentsDay)||this.gurlittMomentsDay.length===0)typeof i=="function"&&i("DauerzaehlstellenRadApi.subscribeLastUpdate: there is no data for day data to base the last update on",this.gurlittMomentsDay);else{const s=this.gurlittMomentsDay[this.gurlittMomentsDay.length-1];a((0,o.default)(s.momentEnd).format("YYYY-MM-DDTHH:mm:ss.000Z"))}typeof n=="function"&&n()}unsubscribeEverything(t){typeof t=="function"&&t()}downloadData(t,r,a,i,e,n,s){if(typeof n=="function"&&n(),t!==this.getThingId()){typeof e=="function"&&e("DauerzaehlstellenRadApi.downloadData: the given thingId is not the one received by the api via api.getThingId()",t),typeof s=="function"&&s();return}else if(typeof a!="object"||a===null||typeof a.interval!="string"){typeof e=="function"&&e("DauerzaehlstellenRadApi.downloadData: the given timeSettings contain a timeSet with an unexpected format",a),typeof s=="function"&&s();return}this.updateTitle(t,f=>{const p={};if(p[r]={},a.interval==="15-Min")this.gurlittMomentsDay.forEach(u=>{p[r][u.momentStart.format("YYYY-MM-DD HH:mm:ss")]=u.result});else if(a.interval==="1-Tag")this.gurlittMomentsWeek.forEach(u=>{p[r][u.momentStart.format("YYYY-MM-DD HH:mm:ss")]=u.result});else if(a.interval==="1-Woche")this.gurlittMomentsYear.forEach(u=>{p[r][u.momentStart.format("YYYY-MM-DD HH:mm:ss")]=u.result});else{typeof e=="function"&&e("DauerzaehlstellenRadApi.updateDataset: unexpected interval",a),typeof s=="function"&&s();return}typeof i=="function"&&i({title:f,data:p}),typeof s=="function"&&s()},e)}getFirstDateEver(t,r,a,i,e,n){if(!this.gurlittMomentsYear.length&&!this.gurlittMomentsWeek.length&&!this.gurlittMomentsDay.length){this.waitingListForCallLinkDownload.push(()=>{this.getFirstDateEver(t,r,a,i,e,n)});return}!Array.isArray(this.gurlittMomentsYear)||!this.gurlittMomentsYear.length||!(this.gurlittMomentsYear[0].momentStart instanceof o.default)?typeof i=="function"&&i("DauerzaehlstellenRadApi.getFirstDateEver: no first date found in gurlittMomentsYear",this.gurlittMomentsYear):typeof a=="function"&&a(this.gurlittMomentsYear[0].momentStart.format("YYYY-MM-DDTHH:mm:ss.SSSZ"))}parseCSVData(t,r=";",a=2){if(typeof t!="string")return!1;const i=t.replace(/\r/g,"").split(`
`),e=[];return i.forEach((n,s)=>{if(s<a)return;const f=n.split(r);e.push(f)}),e}createGurlittMomentDataDay(t){if(!Array.isArray(t))return!1;const r=[];return t.slice(this.offsetOfCsvDataDay).forEach(a=>{if(!Array.isArray(a)||a.length<3)return;const i=a[0],e=a[1].substr(0,5),n=i+e,s=(0,o.default)(n,"DD.MM.YYYYHH:mm");r.push({result:parseInt(a[2],10),momentStart:s,momentEnd:(0,o.default)(s).add(1,"hour")})}),r}createGurlittMomentDataWeek(t){if(!Array.isArray(t))return!1;const r=[],a=t.slice(this.offsetOfCsvDataWeek);let i=0;return a.forEach((e,n)=>{if(!Array.isArray(e)||e.length<3)return;const s=a[n+1],f=s?s[0]:!1,p=e[0];if(i+=parseInt(e[2],10),p!==f){const u=(0,o.default)(p+"00:00","DD.MM.YYYYHH:mm");r.push({result:i,momentStart:u,momentEnd:(0,o.default)(u).add(1,"day")}),i=0}}),r}createGurlittMomentDataYear(t){if(!Array.isArray(t))return!1;const r=[],a={};let i=0,e=!1,n=!1,s=[];return t.slice(this.offsetOfCsvDataYear).forEach(f=>{if(!Array.isArray(f)||f.length<3)return;const p=f[0];Object.prototype.hasOwnProperty.call(a,p)||(a[p]=0),a[p]+=parseInt(f[2],10)}),s=Object.entries(a),s.forEach((f,p)=>{const u=f[0],y=f[1],h=s[p+1],D=Array.isArray(h)?h[0]:!1;if(e===!1?e=(0,o.default)(u,"DD.MM.YYYY").format("WW"):e=n,n=D?(0,o.default)(D,"DD.MM.YYYY").format("WW"):!1,i+=parseInt(y,10),e!==n){const P=(0,o.default)(u,"DD.MM.YYYY").startOf("isoWeek");r.push({result:i,momentStart:P,momentEnd:(0,o.default)(P).endOf("isoWeek")}),i=0}}),r}}}).call(this,Y(6))},4206:function(b,z,Y){(function(W,v){b.exports=v()})(z,function(){"use strict";return function(W,v){var m=v.prototype,w=m.format;m.format=function(k){var d=this,M=this.$locale();if(!this.isValid())return w.bind(this)(k);var _=this.$utils(),c=(k||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(l){switch(l){case"Q":return Math.ceil((d.$M+1)/3);case"Do":return M.ordinal(d.$D);case"gggg":return d.weekYear();case"GGGG":return d.isoWeekYear();case"wo":return M.ordinal(d.week(),"W");case"w":case"ww":return _.s(d.week(),l==="w"?1:2,"0");case"W":case"WW":return _.s(d.isoWeek(),l==="W"?1:2,"0");case"k":case"kk":return _.s(String(d.$H===0?24:d.$H),l==="k"?1:2,"0");case"X":return Math.floor(d.$d.getTime()/1e3);case"x":return d.$d.getTime();case"z":return"["+d.offsetName()+"]";case"zzz":return"["+d.offsetName("long")+"]";default:return l}});return w.bind(this)(c)}}})},4902:function(b,z){var Y=Object.defineProperty,W=Object.getOwnPropertyDescriptor,v=Object.getOwnPropertyNames,m=Object.prototype.hasOwnProperty,w=(c,l)=>{for(var A in l)Y(c,A,{get:l[A],enumerable:!0})},k=(c,l,A,x)=>{if(l&&typeof l=="object"||typeof l=="function")for(let o of v(l))!m.call(c,o)&&o!==A&&Y(c,o,{get:()=>l[o],enumerable:!(x=W(l,o))||x.enumerable});return c},d=c=>k(Y({},"__esModule",{value:!0}),c),M={};w(M,{default:()=>_}),b.exports=d(M);function _(c){return typeof c!="string"?"":c.substr(0,5)==="http:"?"https:"+c.substr(5):c}}}]);
