(window.webpackJsonp=window.webpackJsonp||[]).push([[382,427],{3649:function(C,Y,v){(function(i){var F=Object.defineProperty,T=Object.getOwnPropertyDescriptor,V=Object.getOwnPropertyNames,x=Object.prototype.hasOwnProperty,D=(a,t)=>{for(var e in t)F(a,e,{get:t[e],enumerable:!0})},_=(a,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of V(t))!x.call(a,l)&&l!==e&&F(a,l,{get:()=>t[l],enumerable:!(o=T(t,l))||o.enumerable});return a},j=a=>_(F({},"__esModule",{value:!0}),a),b={};D(b,{addByMouseHover:()=>P,addFolder:()=>W,addModelsByAttributes:()=>K,addVectorLayer:()=>z,closeAllExpandedFolder:()=>M,getCollection:()=>N,getItemByAttributes:()=>J,getItemsByAttributes:()=>U,getModelByAttributes:()=>u,getServiceUrl:()=>O,groupBy:()=>w,offSearchbar:()=>L,onFeaturesLoaded:()=>X,onResetFeatures:()=>k,onSearchbar:()=>A,onShowAllFeatures:()=>G,onShowFeaturesById:()=>E,removeItem:()=>Z,removeModelsById:()=>H,renderTree:()=>B}),C.exports=j(b);function A(a){i.on("Searchbar","hit",a)}function L(){i.off("Searchbar","hit")}function O(a){return i.request("RestReader","getServiceById",a).get("url")}function E(a){i.on("ModelList","showFeaturesById",a)}function G(a){i.on("ModelList","showAllFeatures",a)}function u(a){return i.request("ModelList","getModelByAttributes",a)}function B(){i.trigger("ModelList","renderTree")}function M(){i.trigger("ModelList","closeAllExpandedFolder")}function H(a){i.trigger("ModelList","removeModelsById",a)}function K(a){i.trigger("ModelList","addModelsByAttributes",a)}function N(){return i.request("ModelList","getCollection")}function J(a){return i.request("Parser","getItemByAttributes",a)}function U(a){return i.request("Parser","getItemsByAttributes",a)}function W(a,t,e,o){i.trigger("Parser","addFolder",a,t,e,o)}function z(a,t,e,o,l,r,f){i.trigger("Parser","addVectorLayer",a,t,e,o,l,r,f)}function Z(a){i.trigger("Parser","removeItem",a)}function X(a){i.on("VectorLayer","featuresLoaded",a)}function k(a){i.on("VectorLayer","resetFeatures",a)}function P(a){i.trigger("MouseHover","add",a)}function w(a,t){return i.request("Util","groupBy",a,t)}}).call(this,v(3))},4e3:function(C,Y,v){(function(i){var F=Object.create,T=Object.defineProperty,V=Object.getOwnPropertyDescriptor,x=Object.getOwnPropertyNames,D=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty,j=(t,e)=>{for(var o in e)T(t,o,{get:e[o],enumerable:!0})},b=(t,e,o,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of x(e))!_.call(t,r)&&r!==o&&T(t,r,{get:()=>e[r],enumerable:!(l=V(e,r))||l.enumerable});return t},A=(t,e,o)=>(o=t!=null?F(D(t)):{},b(e||!t||!t.__esModule?T(o,"default",{value:t,enumerable:!0}):o,t)),L=t=>b(T({},"__esModule",{value:!0}),t),O={};j(O,{default:()=>a}),C.exports=L(O);var E=v(58),G=A(v(121)),u=v(40),B=v(4165),M=v(4179),H=v(4178),K=A(v(317)),N=v(3649);const J={kml:new E.KML({extractStyles:!0}),gpx:new E.GPX,geojson:new E.GeoJSON};function U(t,e,o,l){if(e!=="auto")return l[e]===void 0?(console.warn('File import tool: Selected filetype "'+e+'" has no OL Format defined for it.'),!1):l[e];for(const r in o)if(o[r].rgx!==void 0&&t.match(o[r].rgx)!==null){if(l[r]===void 0){console.warn('File import tool: Filetype "'+r+`" is defined as supported, but there isn't any OL Format defined for it.`);continue}return l[r]}return!1}function W(t){let e=t;return e=t.replace(/<.*?cascadingstyle.*?kml:id="(.+)">\s*<style>/gmi,(o,l)=>'<Style id="'+l+'">'),e=e.replace(/<\/Style>\s*<\/.*?cascadingstyle>/gmi,"</Style>"),e}function z(t,e,o,l){const r=new DOMParser().parseFromString(t,"text/xml"),f=r.getElementsByTagName("Placemark");return r.getElementsByTagName("kml").length&&r.getElementsByTagName("kml")[0].attributes.xmlns.value.includes("/2.0")&&r.getElementsByTagName("Folder").length&&Array.prototype.forEach.call(f,n=>{const c=r.getElementsByTagName("Style"),y=n.getElementsByTagName("styleUrl")[0].firstChild.nodeValue.replace("#","");let s="";if(Array.prototype.forEach.call(c,g=>{g.attributes.id.value.includes(y)&&(s=g)}),n.getElementsByTagName("Point").length)if(s.getElementsByTagName("IconStyle").length){const g=s.getElementsByTagName("IconStyle")[0];g.getElementsByTagName("color").length&&g.removeChild(g.getElementsByTagName("color")[0]),g.getElementsByTagName("colorMode")&&g.removeChild(g.getElementsByTagName("colorMode")[0]),g.getElementsByTagName("scale")[0].childNodes[0].nodeValue="1",n.getElementsByTagName("name")[0].childNodes[0].nodeValue=""}else if(n.getElementsByTagName("Data").length&&n.getElementsByTagName("Data")[0].attributes.name.value.includes("feature_name")&&n.getElementsByTagName("Data")[1].attributes.name.value.includes("farbe")){const g=n.getElementsByTagName("Data")[1].getElementsByTagName("value")[0].childNodes[0].nodeValue,m=n.getElementsByTagName("Data")[2].getElementsByTagName("value")[0].childNodes[0].nodeValue,p=new DOMParser().parseFromString("<IconStyle><scale>0</scale><Icon><href>"+e.blue[1]+"</href></Icon></IconStyle>","text/xml");Object.entries(o).forEach(([S,d])=>{g===S&&(s.getElementsByTagName("LabelStyle")[0].getElementsByTagName("color")[0].childNodes[0].nodeValue=d)}),Object.entries(l).forEach(([S,d])=>{if(m===S){const h=new DOMParser().parseFromString("<scale>"+d+"</scale>","text/xml");s.getElementsByTagName("LabelStyle")[0].appendChild(h.getElementsByTagName("scale")[0])}}),n.getElementsByTagName("name")[0].childNodes[0].nodeValue=n.getElementsByTagName("Data")[0].getElementsByTagName("value")[0].childNodes[0].nodeValue,s.appendChild(p.getElementsByTagName("IconStyle")[0])}else if(n.getElementsByTagName("Data").length&&n.getElementsByTagName("Data")[1].attributes.name.value.includes("umkreis_gruppe")){const g=new DOMParser().parseFromString("<IconStyle><scale>0</scale><Icon><href>"+e.blue[1]+"</href></Icon></IconStyle>","text/xml");s.appendChild(g.getElementsByTagName("IconStyle")[0]),n.getElementsByTagName("name")[0].childNodes[0].nodeValue=""}else if(n.getElementsByTagName("ExtendedData").length)n.getElementsByTagName("name")[0].childNodes[0].nodeValue="";else{let g;if(s.getElementsByTagName("LineStyle").length&&s.getElementsByTagName("LineStyle")[0].getElementsByTagName("color").length){const p=s.getElementsByTagName("LineStyle")[0].getElementsByTagName("color")[0].childNodes[0].nodeValue;Object.entries(e).forEach(([,S])=>{S[0]===p&&(g=S[1])})}const m=new DOMParser().parseFromString("<IconStyle><scale>1</scale><Icon><href>"+g+"</href></Icon></IconStyle>","text/xml");s.appendChild(m.getElementsByTagName("IconStyle")[0]),n.getElementsByTagName("name")[0].childNodes[0].nodeValue=""}n.appendChild(s)}),Array.prototype.forEach.call(f,n=>{if(n.getElementsByTagName("name").length&&n.getElementsByTagName("name")[0].childNodes.length&&n.getElementsByTagName("href").length&&n.getElementsByTagName("href")[0].childNodes.length){const c=n.getElementsByTagName("name")[0].childNodes[0].nodeValue,y=n.getElementsByTagName("href")[0].childNodes[0].nodeValue;let s="";y.includes("damage_account.jpg")&&(s=y.replace("damage_account.jpg","damage_account_"+c+".jpg"),n.getElementsByTagName("name")[0].childNodes[0].nodeValue="",n.getElementsByTagName("href")[0].childNodes[0].nodeValue=s)}}),r}function Z(t){const e=t.name,o=t.id,l=t.features;(0,N.getItemByAttributes)({id:"importedData"})===void 0&&((0,N.addFolder)("Importierte Daten","importedData","tree",0),(0,N.renderTree)(),document.getElementById("Overlayer").parentNode.appendChild(document.getElementById("importedData").parentNode)),(0,N.addVectorLayer)(e,o,l,"importedData",void 0,"showAll"),(0,N.closeAllExpandedFolder)();const r=(0,N.getModelByAttributes)({type:"layer",id:o});return X(r,t),k(r,t),(0,N.addByMouseHover)({type:"layer",id:t.id}),r}function X(t,e){t.set({ol_uid:e.id,gfiComplex:"true",gfiTheme:"default",typ:"GeoJSON",isFacility:!0,alwaysOnTop:!0,addressField:e.addressField,mouseHoverField:e.mouseHoverField,searchField:e.searchField,group:"Importierte Datens\xE4tze",filename:e.filename,numericalValues:e.numericalValues,attributeWhiteList:e.filterWhiteList})}function k(t,e){const o=t.layer,l="./assets/svg/"+e.svg;let r="",f="";if(r=(0,B.color)(e.style.svg),f=(0,B.color)(e.style.svg),f.opacity=.5,e.autoStyle){const n=t.get("features");if(isNaN(parseFloat(n[0].get(e.autoStyleValue)))){const c=[...new Set(n.map(s=>s.get(e.autoStyleValue)))],y=w(e.style.svg,c.length);o.setStyle(s=>{if(s.getGeometry().getType()==="Point"){const d=e.rainbow?(c.indexOf(s.get(e.autoStyleValue))+1)/c.length:c.indexOf(s.get(e.autoStyleValue));return new u.Style({image:new u.Icon({src:l,color:e.rainbow?(0,M.interpolateRainbow)(d).toString():(0,B.color)(y(d)).toString()})})}const g=e.rainbow?(c.indexOf(s.get(e.autoStyleValue))+1)/c.length:c.indexOf(s.get(e.autoStyleValue)),m=(0,B.hsl)((0,M.interpolateRainbow)(g)),p=(0,B.hsl)(y(g));return m.opacity=.6,p.opacity=.6,new u.Style({fill:new u.Fill({color:e.rainbow?m:p}),stroke:new u.Stroke({width:3,color:e.rainbow?(0,M.interpolateRainbow)(g).toString():(0,B.color)(y(g)).toString()})})}),o.setZIndex(100)}else{const c=n.map(m=>m.get(e.autoStyleValue)),y=w(e.style.svg,10);let s=0,g=0;c.sort(function(m,p){return m-p}),s=Math.abs(c[0]-c[c.length-1]),s>=10?g=s/10:s>=100?g=s/20:s>=1e3?g=s/50:g=1,o.setStyle(function(m){if(m.getGeometry().getType()==="Point"){const h=P(m,e,g);return new u.Style({image:new u.Icon({src:l,color:(0,B.color)(y(h)).toString()})})}const p=P(m,e,g),S=(0,B.hsl)(y(p));return S.opacity=.6,new u.Style({fill:new u.Fill({color:S.toString()}),stroke:new u.Stroke({width:3,color:(0,B.color)(y(p)).toString()})})}),o.setZIndex(100)}}else{const n=new u.Style({image:new u.Icon({src:l,color:e.style.svg})}),c=new u.Style({image:new u.Circle({radius:5,fill:new u.Fill({color:f}),stroke:new u.Stroke({color:r,width:2})})}),y=new u.Style({fill:new u.Fill({color:f}),stroke:new u.Stroke({width:3,color:r})});o.setStyle(function(s){return s.getGeometry().getType()==="Point"?e.svg?(s.set("originalStyle",n),n):(s.set("originalStyle",c),c):(s.set("originalStyle",y),y)}),o.setZIndex(100)}}function P(t,e,o){for(let l=1;l<11;l++)if(t.get(e.autoStyleValue)<=o*l)return l;return 1}function w(t,e){const o=(0,B.hsl)(t),l=String(o);let r="",f="",n="";return o.h+=10,o.s=100,o.l=80,o.opacity=1,r=String(o),o.h-=10,o.s=0,o.l-=10,o.opacity=.75,f=String(o),n=[f,l,r],(0,H.scaleLinear)().domain([0,e]).range(n)}var a={passLayer({commit:t,dispatch:e,rootGetters:o},l){e("addImportedFilename",l.filename);const r=Z(l),f={attributeWhiteList:l.filterWhiteList,layerId:l.id,title:l.name,strategy:"active",showHits:!0,snippetTags:!0,paging:500,snippets:l.filterWhiteList.map(c=>({title:(0,K.default)(c),attrName:c}))},n=o["Tools/Filter/layers"];return t("Tools/Filter/setLayers",[...n,f],{root:!0}),t("setUpdateLayerStyles",!0),r},deleteLayerFromTree({state:t,commit:e},o){const l=(0,N.getModelByAttributes)({type:"layer",filename:o}),r=mapCollection.getMap("2D"),f=t.importedFileNames.filter(n=>n!==o);r.removeLayer(l.get("layer")),(0,N.removeItem)(l.get("id")),(0,N.removeModelsById)(l.get("id")),(0,N.renderTree)(),e("setImportedFileNames",f)},setSelectedFiletype:({commit:t},e)=>{t("setSelectedFiletype",e)},importKML:({state:t,rootGetters:e,dispatch:o,commit:l},r)=>{const f=r.checkSameLayer,n=r.layerName,c="imported"+(0,G.default)("_"),y=U(r.filename,t.selectedFiletype,t.supportedFiletypes,J),s=e["Maps/projectionCode"];let g=!1,m,p,S=r.raw;if(Array.isArray(f)&&f.length){m={category:i.t("common:modules.alerting.categories.error"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.sameName",{filename:r.filename.split(".")[0]})},o("Alerting/addSingleAlert",m,{root:!0});return}if(y instanceof E.KML&&(S=z(W(r.raw),r.pointImages,r.textColors,r.textSizes)),y===!1){const d=r.filename.split("."),h=d.length>0?"*."+d[d.length-1]:"unknown";m={category:i.t("common:modules.alerting.categories.error"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.missingFormat",{format:h})},o("Alerting/addSingleAlert",m,{root:!0});return}try{if(p=y.readFeatures(S),y instanceof E.KML){const d=[];if(p.forEach((h,I)=>{h.getGeometry()!==null&&h.getGeometry().getType()==="Point"&&h.values_.name===void 0&&d.push(I)}),d.length>0){const h=new E.KML({extractStyles:!0,showPointNames:!1}),I=h.readFeatures(S);d.forEach(Q=>{p[Q]=I[Q]})}}}catch(d){console.warn(d),m={category:i.t("common:modules.alerting.categories.error"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.formatError",{filename:r.filename})},o("Alerting/addSingleAlert",m,{root:!0});return}if(!Array.isArray(p)||p.length===0){m={category:i.t("common:modules.alerting.categories.error"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.missingFileContent",{filename:r.filename})},o("Alerting/addSingleAlert",m,{root:!0});return}p.forEach(d=>{let h;d.getGeometry()===null?(g=!0,m={category:i.t("common:modules.alerting.categories.error"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.featureError")},o("Alerting/addSingleAlert",m,{root:!0})):(d.getGeometry().getType()==="GeometryCollection"?h=d.getGeometry().getGeometries():h=[d.getGeometry()],h.forEach(I=>{I.transform(t.crs,s)}))}),g?m={category:i.t("common:modules.alerting.categories.info"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.successPartly",{filename:r.filename})}:m={category:i.t("common:modules.alerting.categories.info"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.success",{filename:r.filename})},o("Alerting/addSingleAlert",m,{root:!0}),l("setNewLayerInformation",{name:n,id:c,filename:r.filename,features:p})},addImportedFilename:({state:t,commit:e},o)=>{const l=[...t.importedFileNames];l.push(o),e("setImportedFileNames",l)}}}).call(this,v(6))}}]);
