(window.webpackJsonp=window.webpackJsonp||[]).push([[16,488,489,490],{3878:function(x,T,h){(function(m){var b=Object.create,g=Object.defineProperty,j=Object.defineProperties,R=Object.getOwnPropertyDescriptor,I=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertyNames,P=Object.getOwnPropertySymbols,_=Object.getPrototypeOf,w=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,S=(l,s,u)=>s in l?g(l,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[s]=u,p=(l,s)=>{for(var u in s||(s={}))w.call(s,u)&&S(l,u,s[u]);if(P)for(var u of P(s))O.call(s,u)&&S(l,u,s[u]);return l},i=(l,s)=>j(l,I(s)),c=(l,s)=>{for(var u in s)g(l,u,{get:s[u],enumerable:!0})},o=(l,s,u,y)=>{if(s&&typeof s=="object"||typeof s=="function")for(let f of N(s))!w.call(l,f)&&f!==u&&g(l,f,{get:()=>s[f],enumerable:!(y=R(s,f))||y.enumerable});return l},t=(l,s,u)=>(u=l!=null?b(_(l)):{},o(s||!l||!l.__esModule?g(u,"default",{value:l,enumerable:!0}):u,l)),n=l=>o(g({},"__esModule",{value:!0}),l),e={};c(e,{default:()=>v}),x.exports=n(e);var r=t(h(4051)),a=t(h(4052)),d=t(h(4053)),v=i(p(p(p({},r.default),a.default),d.default),{setGeometryByFeatureId({commit:l},s){const u=s.id,y=s.source,f=s.geometry;if(l("setFilteredHouseNumbers",[]),y.getFeatureById(u)&&y.getFeatureById(u).setGeometry(f),f.getType()==="Point")m.trigger("MapView","setCenter",f.getCoordinates(),5);else{const D={duration:0,callback:()=>m.trigger("MapView","setZoomLevelDown")};m.trigger("Map","zoomToExtent",{extent:y.getExtent(),options:D})}},selectInitializeSchoolNumber({commit:l},s){l("setInitialSelectedSchoolNumber",s)}})}).call(this,h(3))},4051:function(x,T,h){var m=Object.defineProperty,b=Object.getOwnPropertyDescriptor,g=Object.getOwnPropertyNames,j=Object.prototype.hasOwnProperty,R=(p,i)=>{for(var c in i)m(p,c,{get:i[c],enumerable:!0})},I=(p,i,c,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of g(i))!j.call(p,t)&&t!==c&&m(p,t,{get:()=>i[t],enumerable:!(o=b(i,t))||o.enumerable});return p},N=p=>I(m({},"__esModule",{value:!0}),p),P={};R(P,{default:()=>S}),x.exports=N(P);var _=h(453),w=h(140),O=h(2109),S={setGazetteerUrl({state:p,rootGetters:i}){var c;(0,_.setGazetteerUrl)((c=i.getRestServiceById(p.serviceId))==null?void 0:c.url)},processInput({dispatch:p},i){const c=i.evt.target.value,o=i.layer;c.slice(-1)!==" "&&c.length>2&&p("searchStreets",{input:c,layer:o})},searchStreets({rootGetters:p,dispatch:i},{input:c,layer:o}){(0,_.search)(c,{map:mapCollection.getMap(p["Maps/mode"]),searchStreets:!0,searchStreetBeforeWord:!1},!0).then(t=>{const n=t.map(e=>e.name).sort();i("processStreetNames",{input:c,layer:o,sortedStreetNames:n})}).catch(t=>{t.message.trim()!=="The operation was aborted."&&t.message.trim()!=="The user aborted a request."&&console.error("schoolRoutePlanning: An error occurred while searching.",t)})},processStreetNames({commit:p,dispatch:i},{input:c,layer:o,sortedStreetNames:t}){t.length===1?(p("setStreetNames",t),i("searchHousenumbers",{streetName:t[0],eventType:"input"})):t.length>0?(p("setStreetNames",t),p("setHouseNumbers",[]),p("setFilteredHouseNumbers",[])):i("filterHouseNumbers",{input:c,layer:o})},searchHousenumbers({rootGetters:p,commit:i},c){const o=c.streetName;c?.eventType==="click"&&(i("setStreetNames",[o]),i("setInputAddress",o)),(0,_.search)(o,{map:mapCollection.getMap(p.mode),searchStreets:!0,searchHouseNumbers:!0,searchStreetBeforeWord:!1}).then(t=>{const n=t.filter(r=>r.type==="houseNumbersForStreet"),e=(0,O.sortObjectsByNestedAttributes)(n,["properties.hausnummernzusatz._","properties.hausnummer._"]);i("setHouseNumbers",e),i("setFilteredHouseNumbers",e)}).catch(t=>{t.message.trim()!=="The operation was aborted."&&t.message.trim()!=="The user aborted a request."&&console.error("schoolRoutePlanning: An error occurred while searching.",t)})},filterHouseNumbers({state:p,commit:i,dispatch:c},o){const t=o.input,n=p.houseNumbers.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()));i("setInputAddress",t),n.length===1?(c("setGeometryByFeatureId",{id:"startPoint",source:o.layer.getSource(),geometry:new w.Point(n[0].geometry.coordinates.map(e=>parseInt(e,10)))}),c("searchRegionalPrimarySchool",n[0].name)):i("setFilteredHouseNumbers",n)},findHouseNumber({state:p,commit:i,dispatch:c},o){var t;const n=o.input,e=p.houseNumbers.find(r=>r.name===n);i("setInputAddress",n),e&&(c("setGeometryByFeatureId",{id:"startPoint",source:o.layer.getSource(),geometry:new w.Point(e.geometry.coordinates.map(r=>parseInt(r,10)))}),c("searchRegionalPrimarySchool",e.name),c("selectSchool",{selectedSchoolId:(t=p.selectedSchoolNumber)==null?void 0:t.id,layer:o.layer}))},searchRegionalPrimarySchool({commit:p,rootGetters:i},c){(0,_.search)(c,{map:mapCollection.getMap(i["Maps/mode"]),searchAddress:!0}).then(o=>{p("setRegionalPrimarySchool",o[0].properties.grundschulnr+"-0")})}}},4052:function(x,T,h){(function(m){var b=Object.create,g=Object.defineProperty,j=Object.getOwnPropertyDescriptor,R=Object.getOwnPropertyNames,I=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty,P=(t,n)=>{for(var e in n)g(t,e,{get:n[e],enumerable:!0})},_=(t,n,e,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of R(n))!N.call(t,a)&&a!==e&&g(t,a,{get:()=>n[a],enumerable:!(r=j(n,a))||r.enumerable});return t},w=(t,n,e)=>(e=t!=null?b(I(t)):{},_(n||!t||!t.__esModule?g(e,"default",{value:t,enumerable:!0}):e,t)),O=t=>_(g({},"__esModule",{value:!0}),t),S=(t,n,e)=>new Promise((r,a)=>{var d=s=>{try{l(e.next(s))}catch(u){a(u)}},v=s=>{try{l(e.throw(s))}catch(u){a(u)}},l=s=>s.done?r(s.value):Promise.resolve(s.value).then(d,v);l((e=e.apply(t,n)).next())}),p={};P(p,{default:()=>o}),x.exports=O(p);var i=w(h(452));function c(t,n=[]){const e=[];let r=null;return n.forEach(a=>{a.get("name")===t?r=a:e.push(a)}),e.push(r),e}var o={printRoute(t,n){return S(this,arguments,function*({state:e,rootGetters:r,dispatch:a},d){var v,l,s;const u=e.routeElements,y=c(e.layerName,r["Maps/getVisibleLayerList"]),f={layout:e.printLayout,outputFormat:e.printOutputFormat,outputFilename:"Schulweg",attributes:{title:e.printTitle,length:`${u.kuerzesteStrecke}m`,address:e.selectedAddress,school:`${(v=e.selectedSchool)==null?void 0:v.get("schulname")}, ${u.SchuleingangTyp} (${u.SchuleingangAdresse})`,map:{dpi:e.printDpi,projection:(l=m.request("MapView","getProjection"))==null?void 0:l.getCode(),center:m.request("MapView","getCenter"),scale:(s=m.request("MapView","getOptions"))==null?void 0:s.scale},datasource:[{table:{columns:["index","description"],data:e.routeDescription}}]}},D=i.default;let M=null;a("Tools/Print/activatePrintStarted",!0,{root:!0}),D.setAttributes(f),yield D.buildLayers(y),M={payload:encodeURIComponent(JSON.stringify(D.defaults)),printAppId:"schulwegrouting",currentFormat:e.printOutputFormat,getResponse:d},a("Tools/Print/createPrintJob",M,{root:!0})})}}}).call(this,h(3))},4053:function(x,T,h){(function(m){var b=Object.create,g=Object.defineProperty,j=Object.getOwnPropertyDescriptor,R=Object.getOwnPropertyNames,I=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty,P=(e,r)=>{for(var a in r)g(e,a,{get:r[a],enumerable:!0})},_=(e,r,a,d)=>{if(r&&typeof r=="object"||typeof r=="function")for(let v of R(r))!N.call(e,v)&&v!==a&&g(e,v,{get:()=>r[v],enumerable:!(d=j(r,v))||d.enumerable});return e},w=(e,r,a)=>(a=e!=null?b(I(e)):{},_(r||!e||!e.__esModule?g(a,"default",{value:e,enumerable:!0}):a,e)),O=e=>_(g({},"__esModule",{value:!0}),e),S={};P(S,{default:()=>n}),x.exports=O(S);var p=w(h(4217)),i=w(h(90)),c=w(h(284)),o=h(140),t=h(58),n={selectSchool({state:e,commit:r,dispatch:a},d){const v=e.houseNumbers.find(s=>s.name.toLowerCase()===e.inputAddress.toLowerCase()),l=d.selectedSchoolId;if(l){const s=e.schools.find(u=>u.get("schul_id")===l);r("setSelectedSchool",s),a("setGeometryByFeatureId",{id:"endPoint",source:d.layer.getSource(),geometry:s?.getGeometry()||[]}),v&&a("prepareWayToSchoolRequest",{selectedHouseNumber:v,selectedSchoolId:l})}},prepareWayToSchoolRequest({state:e,commit:r,dispatch:a},d){var v,l,s,u,y;let f={"Schul-ID":{dataType:"string",value:d.selectedSchoolId},SchuelerStrasse:{dataType:"string",value:e.streetNames[0]},SchuelerHausnr:{dataType:"integer",value:parseInt((l=(v=d.selectedHouseNumber)==null?void 0:v.properties)==null?void 0:l.hausnummer._,10)},SchuelerZusatz:{dataType:"string",value:((y=(u=(s=d.selectedHouseNumber)==null?void 0:s.properties)==null?void 0:u.hausnummernzusatz)==null?void 0:y._)||""},RouteAusgeben:{dataType:"boolean",value:1}};e.wpsTimeout&&Object.keys(e.wpsTimeout).length>0&&(f=Object.assign(f,e.wpsTimeout)),r("setSelectedAddress",e.inputAddress),a("requestWayToSchool",f)},requestWayToSchool({state:e,dispatch:r},a){i.default.show(),p.default.wpsRequest(e.wpsId,e.fmwProcess,a,(d,v)=>r("parseResponseWayToSchool",{response:d,status:v}),5e4)},parseResponseWayToSchool({dispatch:e},r){var a,d,v,l,s,u,y,f,D,M,E,A,C,H,F,W,z,B,G,J,V;i.default.hide();const L=(y=(u=(s=(l=(v=(d=(a=r?.response)==null?void 0:a.ExecuteResponse)==null?void 0:d.ProcessOutputs)==null?void 0:v.Output)==null?void 0:l.Data)==null?void 0:s.ComplexData)==null?void 0:u.Schulweg)==null?void 0:y.Ergebnis;L===void 0?e("Alerting/addSingleAlert",m.t("additional:modules.tools.schoolRoutePlanning.responseError",{errorMessage:((F=(H=(C=(A=(E=(M=(D=(f=r?.response)==null?void 0:f.ExecuteResponse)==null?void 0:D.ProcessOutputs)==null?void 0:M.Output)==null?void 0:E.Data)==null?void 0:A.ComplexData)==null?void 0:C.serviceResponse)==null?void 0:H.statusInfo)==null?void 0:F.message)||((V=(J=(G=(B=(z=(W=r?.response)==null?void 0:W.ExecuteResponse)==null?void 0:z.Status)==null?void 0:B.ProcessFailed)==null?void 0:G.ExceptionReport)==null?void 0:J.Exception)==null?void 0:V.ExceptionText)}),{root:!0}):r.status===200&&L?.ErrorOccured==="no"?e("parseRouteElements",L):e("Alerting/addSingleAlert",m.t("additional:modules.tools.schoolRoutePlanning.wpsError",{status:L.status}),{root:!0})},parseRouteElements({commit:e,dispatch:r},a){const d=a.routenbeschreibung.part,v=a.route.edge;e("setRouteElements",a),e("setRouteDescription",Array.isArray(d)?d:[d]),e("setRouteLength",(0,c.default)(a.kuerzesteStrecke)+"m"),r("parseRoute",Array.isArray(v)?v:[v])},parseRoute({commit:e},r){const a=new t.WKT,d=new o.MultiLineString({});r.forEach(v=>{d.appendLineString(a.readGeometry(v.wkt))}),e("setRouteGeometry",d)}}}).call(this,h(6))},4217:function(x,T,h){var m=Object.create,b=Object.defineProperty,g=Object.getOwnPropertyDescriptor,j=Object.getOwnPropertyNames,R=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty,N=(o,t)=>{for(var n in t)b(o,n,{get:t[n],enumerable:!0})},P=(o,t,n,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of j(t))!I.call(o,r)&&r!==n&&b(o,r,{get:()=>t[r],enumerable:!(e=g(t,r))||e.enumerable});return o},_=(o,t,n)=>(n=o!=null?m(R(o)):{},P(t||!o||!o.__esModule?b(n,"default",{value:o,enumerable:!0}):n,o)),w=o=>P(b({},"__esModule",{value:!0}),o),O={};N(O,{default:()=>c}),x.exports=w(O);var S=_(h(25)),p=_(h(1203)),i=_(h(7)),c={sendRequest:function(o,t,n,e){(0,S.default)({method:"post",url:o,data:t,headers:{"Content-Type":"text/xml"},timeout:e}).then(r=>this.handleResponse(r,n))},handleResponse:function(o,t){let n;o.status===200&&(n=this.parseDataString(o.data)),t(n,o.status)},parseDataString:function(o){const t=new DOMParser().parseFromString(o,"text/xml");return(0,p.default)(t,!1)},buildXML:function(o,t,n,e={}){let r=this.setXMLElement(t,"</ows:Identifier>",o);return Object.entries(e).forEach(a=>{const d=a[1],v=a[0],l=Object.prototype.hasOwnProperty.call(d,"dataType")?d.dataType:void 0,s=Object.prototype.hasOwnProperty.call(d,"value")?d.value:d;let u;u=this.setXMLElement(n,"</ows:Identifier>",v),u=this.setXMLElement(u,"</wps:LiteralData>",s,l),r=this.setXMLElement(r,"</wps:DataInputs>",u)}),r},setXMLElement:function(o,t,n,e){let r=o===void 0?"":o;return e!==void 0&&(r=r.toString().replace("<wps:LiteralData>","<wps:LiteralData dataType='"+e+"'>")),o!==void 0&&t!==void 0&&n!==void 0&&(r=r.toString().replace(t.toString(),n.toString()+t.toString())),r},wpsRequest:function(o,t,n,e,r){var a;const d='<wps:Execute xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ows="http://www.opengis.net/ows/1.1" service="WPS" version="1.0.0" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsExecute_request.xsd"><ows:Identifier></ows:Identifier><wps:DataInputs></wps:DataInputs></wps:Execute>',v="<wps:Input><ows:Identifier></ows:Identifier><wps:Data><wps:LiteralData></wps:LiteralData></wps:Data></wps:Input>",l=this.buildXML(t,d,v,n),s=(a=i.default.getters.getRestServiceById(o))==null?void 0:a.url;this.sendRequest(s,l,e,r)}}}}]);
