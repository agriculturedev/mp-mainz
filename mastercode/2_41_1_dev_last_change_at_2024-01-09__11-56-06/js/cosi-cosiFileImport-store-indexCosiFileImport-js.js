(window.webpackJsonp=window.webpackJsonp||[]).push([[25,382,383,384,385,427],{3649:function(A,z,f){(function(i){var v=Object.defineProperty,M=Object.getOwnPropertyDescriptor,D=Object.getOwnPropertyNames,x=Object.prototype.hasOwnProperty,V=(g,r)=>{for(var e in r)v(g,e,{get:r[e],enumerable:!0})},T=(g,r,e,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of D(r))!x.call(g,s)&&s!==e&&v(g,s,{get:()=>r[s],enumerable:!(a=M(r,s))||a.enumerable});return g},L=g=>T(v({},"__esModule",{value:!0}),g),S={};V(S,{addByMouseHover:()=>k,addFolder:()=>p,addModelsByAttributes:()=>K,addVectorLayer:()=>B,closeAllExpandedFolder:()=>G,getCollection:()=>l,getItemByAttributes:()=>t,getItemsByAttributes:()=>o,getModelByAttributes:()=>d,getServiceUrl:()=>E,groupBy:()=>Z,offSearchbar:()=>C,onFeaturesLoaded:()=>$,onResetFeatures:()=>X,onSearchbar:()=>b,onShowAllFeatures:()=>J,onShowFeaturesById:()=>_,removeItem:()=>H,removeModelsById:()=>U,renderTree:()=>P}),A.exports=L(S);function b(g){i.on("Searchbar","hit",g)}function C(){i.off("Searchbar","hit")}function E(g){return i.request("RestReader","getServiceById",g).get("url")}function _(g){i.on("ModelList","showFeaturesById",g)}function J(g){i.on("ModelList","showAllFeatures",g)}function d(g){return i.request("ModelList","getModelByAttributes",g)}function P(){i.trigger("ModelList","renderTree")}function G(){i.trigger("ModelList","closeAllExpandedFolder")}function U(g){i.trigger("ModelList","removeModelsById",g)}function K(g){i.trigger("ModelList","addModelsByAttributes",g)}function l(){return i.request("ModelList","getCollection")}function t(g){return i.request("Parser","getItemByAttributes",g)}function o(g){return i.request("Parser","getItemsByAttributes",g)}function p(g,r,e,a){i.trigger("Parser","addFolder",g,r,e,a)}function B(g,r,e,a,s,n,N){i.trigger("Parser","addVectorLayer",g,r,e,a,s,n,N)}function H(g){i.trigger("Parser","removeItem",g)}function $(g){i.on("VectorLayer","featuresLoaded",g)}function X(g){i.on("VectorLayer","resetFeatures",g)}function k(g){i.trigger("MouseHover","add",g)}function Z(g,r){return i.request("Util","groupBy",g,r)}}).call(this,f(3))},3735:function(A,z){var f=Object.defineProperty,i=Object.getOwnPropertyDescriptor,v=Object.getOwnPropertyNames,M=Object.prototype.hasOwnProperty,D=(S,b)=>{for(var C in b)f(S,C,{get:b[C],enumerable:!0})},x=(S,b,C,E)=>{if(b&&typeof b=="object"||typeof b=="function")for(let _ of v(b))!M.call(S,_)&&_!==C&&f(S,_,{get:()=>b[_],enumerable:!(E=i(b,_))||E.enumerable});return S},V=S=>x(f({},"__esModule",{value:!0}),S),T={};D(T,{default:()=>L}),A.exports=V(T);var L={active:!1,deactivateGFI:!1,icon:"bi-upload",id:"cosiFileImport",name:"KML-Datei laden",pointImages:{black:["cc000000","/img/tools/draw/circle_black.svg"],blue:["cc0000FF","/img/tools/draw/circle_blue.svg"],green:["cc00FF00","/img/tools/draw/circle_green.svg"],yellow:["cc00FFFF","/img/tools/draw/circle_yellow.svg"],red:["ccFF0000","/img/tools/draw/circle_red.svg"],white:["ccFFFFFF","/img/tools/draw/circle_white.svg"]},textColors:{schwarz:"cc000000",blau:"ccFF0000",gruen:"cc00FF00",gelb:"cc00FFFF",rot:"cc0000FF",weiss:"ccFFFFFF"},textSizes:{klein:1,mittel:1.15,gross:1.3},onlyDesktop:!0,renderToWindow:!0,resizableWindow:!1,selectedFiletype:"auto",importedFileNames:[],supportedFiletypes:{auto:{caption:"additional:modules.tools.CosiFileImport.captions.supportedFiletypes.auto"},kml:{caption:"additional:modules.tools.CosiFileImport.captions.supportedFiletypes.kml",rgx:/\.kml$/i},gpx:{caption:"additional:modules.tools.CosiFileImport.captions.supportedFiletypes.gpx",rgx:/\.gpx$/i},geojson:{caption:"additional:modules.tools.CosiFileImport.captions.supportedFiletypes.geojson",rgx:/\.(geo)?json$/i}},title:"KML-Datei laden",newLayerInformation:{},importedLayers:[],activeLayer:0,updateLayerStyles:!1,crs:"EPSG:4326",readmeUrl:{"en-US":"https://bitbucket.org/geowerkstatt-hamburg/addons/src/dev/cosi/manuals/013fileimport.md","de-DE":"https://bitbucket.org/geowerkstatt-hamburg/addons/src/dev/cosi/manuals/013geodatenimportieren.md"}}},3892:function(A,z,f){var i=Object.create,v=Object.defineProperty,M=Object.getOwnPropertyDescriptor,D=Object.getOwnPropertyNames,x=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,S=(l,t,o)=>t in l?v(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o,b=(l,t)=>{for(var o in t||(t={}))T.call(t,o)&&S(l,o,t[o]);if(x)for(var o of x(t))L.call(t,o)&&S(l,o,t[o]);return l},C=(l,t)=>{for(var o in t)v(l,o,{get:t[o],enumerable:!0})},E=(l,t,o,p)=>{if(t&&typeof t=="object"||typeof t=="function")for(let B of D(t))!T.call(l,B)&&B!==o&&v(l,B,{get:()=>t[B],enumerable:!(p=M(t,B))||p.enumerable});return l},_=(l,t,o)=>(o=l!=null?i(V(l)):{},E(t||!l||!l.__esModule?v(o,"default",{value:l,enumerable:!0}):o,l)),J=l=>E(v({},"__esModule",{value:!0}),l),d={};C(d,{default:()=>K}),A.exports=J(d);var P=f(10),G=_(f(3735)),K=b({},(0,P.generateSimpleGetters)(G.default))},3893:function(A,z,f){var i=Object.create,v=Object.defineProperty,M=Object.getOwnPropertyDescriptor,D=Object.getOwnPropertyNames,x=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,S=(l,t,o)=>t in l?v(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o,b=(l,t)=>{for(var o in t||(t={}))T.call(t,o)&&S(l,o,t[o]);if(x)for(var o of x(t))L.call(t,o)&&S(l,o,t[o]);return l},C=(l,t)=>{for(var o in t)v(l,o,{get:t[o],enumerable:!0})},E=(l,t,o,p)=>{if(t&&typeof t=="object"||typeof t=="function")for(let B of D(t))!T.call(l,B)&&B!==o&&v(l,B,{get:()=>t[B],enumerable:!(p=M(t,B))||p.enumerable});return l},_=(l,t,o)=>(o=l!=null?i(V(l)):{},E(t||!l||!l.__esModule?v(o,"default",{value:l,enumerable:!0}):o,l)),J=l=>E(v({},"__esModule",{value:!0}),l),d={};C(d,{default:()=>K}),A.exports=J(d);var P=f(10),G=_(f(3735)),K=b({},(0,P.generateSimpleMutations)(G.default))},4e3:function(A,z,f){(function(i){var v=Object.create,M=Object.defineProperty,D=Object.getOwnPropertyDescriptor,x=Object.getOwnPropertyNames,V=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty,L=(r,e)=>{for(var a in e)M(r,a,{get:e[a],enumerable:!0})},S=(r,e,a,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of x(e))!T.call(r,n)&&n!==a&&M(r,n,{get:()=>e[n],enumerable:!(s=D(e,n))||s.enumerable});return r},b=(r,e,a)=>(a=r!=null?v(V(r)):{},S(e||!r||!r.__esModule?M(a,"default",{value:r,enumerable:!0}):a,r)),C=r=>S(M({},"__esModule",{value:!0}),r),E={};L(E,{default:()=>g}),A.exports=C(E);var _=f(58),J=b(f(121)),d=f(40),P=f(4165),G=f(4179),U=f(4178),K=b(f(317)),l=f(3649);const t={kml:new _.KML({extractStyles:!0}),gpx:new _.GPX,geojson:new _.GeoJSON};function o(r,e,a,s){if(e!=="auto")return s[e]===void 0?(console.warn('File import tool: Selected filetype "'+e+'" has no OL Format defined for it.'),!1):s[e];for(const n in a)if(a[n].rgx!==void 0&&r.match(a[n].rgx)!==null){if(s[n]===void 0){console.warn('File import tool: Filetype "'+n+`" is defined as supported, but there isn't any OL Format defined for it.`);continue}return s[n]}return!1}function p(r){let e=r;return e=r.replace(/<.*?cascadingstyle.*?kml:id="(.+)">\s*<style>/gmi,(a,s)=>'<Style id="'+s+'">'),e=e.replace(/<\/Style>\s*<\/.*?cascadingstyle>/gmi,"</Style>"),e}function B(r,e,a,s){const n=new DOMParser().parseFromString(r,"text/xml"),N=n.getElementsByTagName("Placemark");return n.getElementsByTagName("kml").length&&n.getElementsByTagName("kml")[0].attributes.xmlns.value.includes("/2.0")&&n.getElementsByTagName("Folder").length&&Array.prototype.forEach.call(N,c=>{const h=n.getElementsByTagName("Style"),O=c.getElementsByTagName("styleUrl")[0].firstChild.nodeValue.replace("#","");let u="";if(Array.prototype.forEach.call(h,m=>{m.attributes.id.value.includes(O)&&(u=m)}),c.getElementsByTagName("Point").length)if(u.getElementsByTagName("IconStyle").length){const m=u.getElementsByTagName("IconStyle")[0];m.getElementsByTagName("color").length&&m.removeChild(m.getElementsByTagName("color")[0]),m.getElementsByTagName("colorMode")&&m.removeChild(m.getElementsByTagName("colorMode")[0]),m.getElementsByTagName("scale")[0].childNodes[0].nodeValue="1",c.getElementsByTagName("name")[0].childNodes[0].nodeValue=""}else if(c.getElementsByTagName("Data").length&&c.getElementsByTagName("Data")[0].attributes.name.value.includes("feature_name")&&c.getElementsByTagName("Data")[1].attributes.name.value.includes("farbe")){const m=c.getElementsByTagName("Data")[1].getElementsByTagName("value")[0].childNodes[0].nodeValue,y=c.getElementsByTagName("Data")[2].getElementsByTagName("value")[0].childNodes[0].nodeValue,I=new DOMParser().parseFromString("<IconStyle><scale>0</scale><Icon><href>"+e.blue[1]+"</href></Icon></IconStyle>","text/xml");Object.entries(a).forEach(([j,F])=>{m===j&&(u.getElementsByTagName("LabelStyle")[0].getElementsByTagName("color")[0].childNodes[0].nodeValue=F)}),Object.entries(s).forEach(([j,F])=>{if(y===j){const w=new DOMParser().parseFromString("<scale>"+F+"</scale>","text/xml");u.getElementsByTagName("LabelStyle")[0].appendChild(w.getElementsByTagName("scale")[0])}}),c.getElementsByTagName("name")[0].childNodes[0].nodeValue=c.getElementsByTagName("Data")[0].getElementsByTagName("value")[0].childNodes[0].nodeValue,u.appendChild(I.getElementsByTagName("IconStyle")[0])}else if(c.getElementsByTagName("Data").length&&c.getElementsByTagName("Data")[1].attributes.name.value.includes("umkreis_gruppe")){const m=new DOMParser().parseFromString("<IconStyle><scale>0</scale><Icon><href>"+e.blue[1]+"</href></Icon></IconStyle>","text/xml");u.appendChild(m.getElementsByTagName("IconStyle")[0]),c.getElementsByTagName("name")[0].childNodes[0].nodeValue=""}else if(c.getElementsByTagName("ExtendedData").length)c.getElementsByTagName("name")[0].childNodes[0].nodeValue="";else{let m;if(u.getElementsByTagName("LineStyle").length&&u.getElementsByTagName("LineStyle")[0].getElementsByTagName("color").length){const I=u.getElementsByTagName("LineStyle")[0].getElementsByTagName("color")[0].childNodes[0].nodeValue;Object.entries(e).forEach(([,j])=>{j[0]===I&&(m=j[1])})}const y=new DOMParser().parseFromString("<IconStyle><scale>1</scale><Icon><href>"+m+"</href></Icon></IconStyle>","text/xml");u.appendChild(y.getElementsByTagName("IconStyle")[0]),c.getElementsByTagName("name")[0].childNodes[0].nodeValue=""}c.appendChild(u)}),Array.prototype.forEach.call(N,c=>{if(c.getElementsByTagName("name").length&&c.getElementsByTagName("name")[0].childNodes.length&&c.getElementsByTagName("href").length&&c.getElementsByTagName("href")[0].childNodes.length){const h=c.getElementsByTagName("name")[0].childNodes[0].nodeValue,O=c.getElementsByTagName("href")[0].childNodes[0].nodeValue;let u="";O.includes("damage_account.jpg")&&(u=O.replace("damage_account.jpg","damage_account_"+h+".jpg"),c.getElementsByTagName("name")[0].childNodes[0].nodeValue="",c.getElementsByTagName("href")[0].childNodes[0].nodeValue=u)}}),n}function H(r){const e=r.name,a=r.id,s=r.features;(0,l.getItemByAttributes)({id:"importedData"})===void 0&&((0,l.addFolder)("Importierte Daten","importedData","tree",0),(0,l.renderTree)(),document.getElementById("Overlayer").parentNode.appendChild(document.getElementById("importedData").parentNode)),(0,l.addVectorLayer)(e,a,s,"importedData",void 0,"showAll"),(0,l.closeAllExpandedFolder)();const n=(0,l.getModelByAttributes)({type:"layer",id:a});return $(n,r),X(n,r),(0,l.addByMouseHover)({type:"layer",id:r.id}),n}function $(r,e){r.set({ol_uid:e.id,gfiComplex:"true",gfiTheme:"default",typ:"GeoJSON",isFacility:!0,alwaysOnTop:!0,addressField:e.addressField,mouseHoverField:e.mouseHoverField,searchField:e.searchField,group:"Importierte Datens\xE4tze",filename:e.filename,numericalValues:e.numericalValues,attributeWhiteList:e.filterWhiteList})}function X(r,e){const a=r.layer,s="./assets/svg/"+e.svg;let n="",N="";if(n=(0,P.color)(e.style.svg),N=(0,P.color)(e.style.svg),N.opacity=.5,e.autoStyle){const c=r.get("features");if(isNaN(parseFloat(c[0].get(e.autoStyleValue)))){const h=[...new Set(c.map(u=>u.get(e.autoStyleValue)))],O=Z(e.style.svg,h.length);a.setStyle(u=>{if(u.getGeometry().getType()==="Point"){const F=e.rainbow?(h.indexOf(u.get(e.autoStyleValue))+1)/h.length:h.indexOf(u.get(e.autoStyleValue));return new d.Style({image:new d.Icon({src:s,color:e.rainbow?(0,G.interpolateRainbow)(F).toString():(0,P.color)(O(F)).toString()})})}const m=e.rainbow?(h.indexOf(u.get(e.autoStyleValue))+1)/h.length:h.indexOf(u.get(e.autoStyleValue)),y=(0,P.hsl)((0,G.interpolateRainbow)(m)),I=(0,P.hsl)(O(m));return y.opacity=.6,I.opacity=.6,new d.Style({fill:new d.Fill({color:e.rainbow?y:I}),stroke:new d.Stroke({width:3,color:e.rainbow?(0,G.interpolateRainbow)(m).toString():(0,P.color)(O(m)).toString()})})}),a.setZIndex(100)}else{const h=c.map(y=>y.get(e.autoStyleValue)),O=Z(e.style.svg,10);let u=0,m=0;h.sort(function(y,I){return y-I}),u=Math.abs(h[0]-h[h.length-1]),u>=10?m=u/10:u>=100?m=u/20:u>=1e3?m=u/50:m=1,a.setStyle(function(y){if(y.getGeometry().getType()==="Point"){const w=k(y,e,m);return new d.Style({image:new d.Icon({src:s,color:(0,P.color)(O(w)).toString()})})}const I=k(y,e,m),j=(0,P.hsl)(O(I));return j.opacity=.6,new d.Style({fill:new d.Fill({color:j.toString()}),stroke:new d.Stroke({width:3,color:(0,P.color)(O(I)).toString()})})}),a.setZIndex(100)}}else{const c=new d.Style({image:new d.Icon({src:s,color:e.style.svg})}),h=new d.Style({image:new d.Circle({radius:5,fill:new d.Fill({color:N}),stroke:new d.Stroke({color:n,width:2})})}),O=new d.Style({fill:new d.Fill({color:N}),stroke:new d.Stroke({width:3,color:n})});a.setStyle(function(u){return u.getGeometry().getType()==="Point"?e.svg?(u.set("originalStyle",c),c):(u.set("originalStyle",h),h):(u.set("originalStyle",O),O)}),a.setZIndex(100)}}function k(r,e,a){for(let s=1;s<11;s++)if(r.get(e.autoStyleValue)<=a*s)return s;return 1}function Z(r,e){const a=(0,P.hsl)(r),s=String(a);let n="",N="",c="";return a.h+=10,a.s=100,a.l=80,a.opacity=1,n=String(a),a.h-=10,a.s=0,a.l-=10,a.opacity=.75,N=String(a),c=[N,s,n],(0,U.scaleLinear)().domain([0,e]).range(c)}var g={passLayer({commit:r,dispatch:e,rootGetters:a},s){e("addImportedFilename",s.filename);const n=H(s),N={attributeWhiteList:s.filterWhiteList,layerId:s.id,title:s.name,strategy:"active",showHits:!0,snippetTags:!0,paging:500,snippets:s.filterWhiteList.map(h=>({title:(0,K.default)(h),attrName:h}))},c=a["Tools/Filter/layers"];return r("Tools/Filter/setLayers",[...c,N],{root:!0}),r("setUpdateLayerStyles",!0),n},deleteLayerFromTree({state:r,commit:e},a){const s=(0,l.getModelByAttributes)({type:"layer",filename:a}),n=mapCollection.getMap("2D"),N=r.importedFileNames.filter(c=>c!==a);n.removeLayer(s.get("layer")),(0,l.removeItem)(s.get("id")),(0,l.removeModelsById)(s.get("id")),(0,l.renderTree)(),e("setImportedFileNames",N)},setSelectedFiletype:({commit:r},e)=>{r("setSelectedFiletype",e)},importKML:({state:r,rootGetters:e,dispatch:a,commit:s},n)=>{const N=n.checkSameLayer,c=n.layerName,h="imported"+(0,J.default)("_"),O=o(n.filename,r.selectedFiletype,r.supportedFiletypes,t),u=e["Maps/projectionCode"];let m=!1,y,I,j=n.raw;if(Array.isArray(N)&&N.length){y={category:i.t("common:modules.alerting.categories.error"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.sameName",{filename:n.filename.split(".")[0]})},a("Alerting/addSingleAlert",y,{root:!0});return}if(O instanceof _.KML&&(j=B(p(n.raw),n.pointImages,n.textColors,n.textSizes)),O===!1){const F=n.filename.split("."),w=F.length>0?"*."+F[F.length-1]:"unknown";y={category:i.t("common:modules.alerting.categories.error"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.missingFormat",{format:w})},a("Alerting/addSingleAlert",y,{root:!0});return}try{if(I=O.readFeatures(j),O instanceof _.KML){const F=[];if(I.forEach((w,W)=>{w.getGeometry()!==null&&w.getGeometry().getType()==="Point"&&w.values_.name===void 0&&F.push(W)}),F.length>0){const w=new _.KML({extractStyles:!0,showPointNames:!1}),W=w.readFeatures(j);F.forEach(Q=>{I[Q]=W[Q]})}}}catch(F){console.warn(F),y={category:i.t("common:modules.alerting.categories.error"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.formatError",{filename:n.filename})},a("Alerting/addSingleAlert",y,{root:!0});return}if(!Array.isArray(I)||I.length===0){y={category:i.t("common:modules.alerting.categories.error"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.missingFileContent",{filename:n.filename})},a("Alerting/addSingleAlert",y,{root:!0});return}I.forEach(F=>{let w;F.getGeometry()===null?(m=!0,y={category:i.t("common:modules.alerting.categories.error"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.featureError")},a("Alerting/addSingleAlert",y,{root:!0})):(F.getGeometry().getType()==="GeometryCollection"?w=F.getGeometry().getGeometries():w=[F.getGeometry()],w.forEach(W=>{W.transform(r.crs,u)}))}),m?y={category:i.t("common:modules.alerting.categories.info"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.successPartly",{filename:n.filename})}:y={category:i.t("common:modules.alerting.categories.info"),content:i.t("additional:modules.tools.cosiFileImport.alertingMessages.success",{filename:n.filename})},a("Alerting/addSingleAlert",y,{root:!0}),s("setNewLayerInformation",{name:c,id:h,filename:n.filename,features:I})},addImportedFilename:({state:r,commit:e},a)=>{const s=[...r.importedFileNames];s.push(a),e("setImportedFileNames",s)}}}).call(this,f(6))},4125:function(A,z,f){var i=Object.create,v=Object.defineProperty,M=Object.getOwnPropertyDescriptor,D=Object.getOwnPropertyNames,x=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,S=(t,o,p)=>o in t?v(t,o,{enumerable:!0,configurable:!0,writable:!0,value:p}):t[o]=p,b=(t,o)=>{for(var p in o||(o={}))T.call(o,p)&&S(t,p,o[p]);if(x)for(var p of x(o))L.call(o,p)&&S(t,p,o[p]);return t},C=(t,o)=>{for(var p in o)v(t,p,{get:o[p],enumerable:!0})},E=(t,o,p,B)=>{if(o&&typeof o=="object"||typeof o=="function")for(let H of D(o))!T.call(t,H)&&H!==p&&v(t,H,{get:()=>o[H],enumerable:!(B=M(o,H))||B.enumerable});return t},_=(t,o,p)=>(p=t!=null?i(V(t)):{},E(o||!t||!t.__esModule?v(p,"default",{value:t,enumerable:!0}):p,t)),J=t=>E(v({},"__esModule",{value:!0}),t),d={};C(d,{default:()=>l}),A.exports=J(d);var P=_(f(3735)),G=_(f(4e3)),U=_(f(3892)),K=_(f(3893)),l={namespaced:!0,state:b({},P.default),mutations:K.default,actions:G.default,getters:U.default}}}]);
