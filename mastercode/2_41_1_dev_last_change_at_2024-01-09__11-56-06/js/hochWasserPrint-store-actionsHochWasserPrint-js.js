(window.webpackJsonp=window.webpackJsonp||[]).push([[454],{3873:function(I,B,p){(function(v,_){var x=Object.create,d=Object.defineProperty,h=Object.defineProperties,F=Object.getOwnPropertyDescriptor,L=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertyNames,g=Object.getOwnPropertySymbols,J=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,S=(r,t,e)=>t in r?d(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,R=(r,t)=>{for(var e in t||(t={}))b.call(t,e)&&S(r,e,t[e]);if(g)for(var e of g(t))A.call(t,e)&&S(r,e,t[e]);return r},E=(r,t)=>h(r,L(t)),T=(r,t)=>{for(var e in t)d(r,e,{get:t[e],enumerable:!0})},w=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of j(t))!b.call(r,i)&&i!==e&&d(r,i,{get:()=>t[i],enumerable:!(n=F(t,i))||n.enumerable});return r},f=(r,t,e)=>(e=r!=null?x(J(r)):{},w(t||!r||!r.__esModule?d(e,"default",{value:r,enumerable:!0}):e,r)),N=r=>w(d({},"__esModule",{value:!0}),r),y=(r,t,e)=>new Promise((n,i)=>{var l=a=>{try{o(e.next(a))}catch(c){i(c)}},s=a=>{try{o(e.throw(a))}catch(c){i(c)}},o=a=>a.done?n(a.value):Promise.resolve(a.value).then(l,s);o((e=e.apply(r,t)).next())}),O={};T(O,{default:()=>W}),I.exports=N(O);var C=f(p(25)),M=f(p(68)),D=f(p(3894)),V=f(p(1209)),H=f(p(3829)),W=E(R({},H.default),{sendRequest:function({state:r,dispatch:t},e){const n=r.useProxy?(0,M.default)(e.serviceUrl):e.serviceUrl;(0,C.default)({url:n,type:e.requestType}).then(i=>{Object.prototype.hasOwnProperty.call(e,"index")&&(i.data.index=e.index),t(String(e.onSuccess),i.data)})},activatePrintStarted:function({commit:r}){r("setPrintStarted",!0)},setVisibleLayerList:function({commit:r},t){r("setVisibleLayerList",t)},startPrint:function(r,t){return y(this,arguments,function*({state:e,dispatch:n},i){const l=e.printLayerList,s={layout:e.currentLayoutName,outputFilename:e.filename,outputFormat:e.currentFormat,attributes:{printId:e.printHwsId,map:{dpi:e.dpiForPdf,projection:v.request("MapView","getProjection").getCode(),center:v.request("MapView","getCenter"),scale:e.currentScale}}};let o=D.default,a={};o.setAttributes(s),e.isScaleAvailable&&o.buildScale(e.currentScale),yield o.buildLayers(l),o=(0,V.default)(o,["uniqueIdList"]),a={index:i.index,payload:encodeURIComponent(JSON.stringify(o.defaults)),printAppId:e.printAppId,currentFormat:e.currentFormat,getResponse:i.getResponse},v.trigger("Util","showLoader"),n("createPrintJob",a)})},createPrintJob:function(r,t){return y(this,arguments,function*({state:e,dispatch:n,rootGetters:i,commit:l},s){const o=s,a=o.printAppId||e.printAppId,c=o.format||e.currentFormat;let U="",m="",P=e.serviceUrl;if(e.serviceUrl.includes("/print/")||(P=e.serviceUrl+"print/"),l("setPrintFileReady",!1),e.serviceUrl===""){let u;e.mapfishServiceId!==""?u=i.getRestServiceById(e.mapfishServiceId).url:u=i.getRestServiceById("mapfish").url,u.includes("/print/")||(u=u+"print/"),l("setServiceUrl",u),P=e.serviceUrl}U=e.printService==="plotservice"?P+"/create.json":P+a+"/report."+c,typeof o.getResponse=="function"&&(e.printService==="plotservice"&&(o.payload=yield n("migratePayload",o.payload)),m=yield o.getResponse(U,o.payload)),m.data.index=o.index,n("waitForPrintJob",m.data)})},migratePayload:function({state:r},t){const e={},n=JSON.parse(decodeURIComponent(t.replace(/imageFormat/g,"format")));return e.layout=n.layout,e.srs=n.attributes.map.projection,e.layers=n.attributes.map.layers,e.layers.forEach(i=>{i.styles=[""]}),e.pages=[{center:n.attributes.map.center,scale:String(n.attributes.map.scale),scaleText:"Ca. 1 : "+n.attributes.map.scale,geodetic:!0,dpi:String(n.attributes.map.dpi),mapTitle:n.attributes.title}],e.outputFilename=r.filename,e.outputFormat=r.outputFormat,JSON.stringify(e)},waitForPrintJob:function(r,t){return y(this,arguments,function*({state:e,dispatch:n},i){let l="";e.serviceUrl.includes("/print/")||(l="print/");const s=e.printAppId,o=e.serviceUrl+l+s+"/status/"+i.ref+".json",a={index:i.index,serviceUrl:o,requestType:"GET",onSuccess:"waitForPrintJobSuccess"};n("sendRequest",a)})},waitForPrintJobSuccess:function(r,t){return y(this,arguments,function*({state:e,dispatch:n},i){let l="";if(e.serviceUrl.includes("/print/")||(l="print/"),i.status==="error")n("Alerting/addSingleAlert",_.t("additional:modules.tools.hochWasserPrint.waitForPrintErrorMessage"),{root:!0}),console.error("Error: "+i.error);else if(i.done){const s=i.downloadURL.lastIndexOf("/"),o=i.downloadURL.substr(s);v.trigger("Util","hideLoader"),window.open(e.serviceUrl+l+e.printAppId+"/report"+o)}else setTimeout(()=>{const s=i.downloadURL.lastIndexOf("/"),o=i.downloadURL.substr(s),a=e.serviceUrl+l+e.printAppId+"/status"+o+".json",c={index:i.index,serviceUrl:a,requestType:"GET",onSuccess:"waitForPrintJobSuccess"};n("sendRequest",c)},2e3)})}})}).call(this,p(3),p(6))}}]);
