(window.webpackJsonp=window.webpackJsonp||[]).push([[12,453,459,460],{3828:function(B,Z,p){(function(T){var G=Object.create,R=Object.defineProperty,N=Object.getOwnPropertyDescriptor,U=Object.getOwnPropertyNames,H=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty,J=(S,m)=>{for(var v in m)R(S,v,{get:m[v],enumerable:!0})},_=(S,m,v,E)=>{if(m&&typeof m=="object"||typeof m=="function")for(let W of U(m))!k.call(S,W)&&W!==v&&R(S,W,{get:()=>m[W],enumerable:!(E=N(m,W))||E.enumerable});return S},P=(S,m,v)=>(v=S!=null?G(H(S)):{},_(m||!S||!S.__esModule?R(v,"default",{value:S,enumerable:!0}):v,S)),D=S=>_(R({},"__esModule",{value:!0}),S),V={};J(V,{default:()=>A}),B.exports=D(V);var h=P(p(1208)),L=P(p(167)),I=P(p(7));function A(S=!1){const m=T.request("Map","getLayers"),v=typeof m?.getArray!="function"?[]:m.getArray().filter(E=>E.getVisible()===!0&&(E.get("name")!=="markerPoint"||S));Array.isArray(v)&&v.length&&O(v)}function O(S){const m=S.filter(E=>typeof E.getZIndex()<"u"),v=(0,h.default)(S,m);v.push((0,L.default)(m,E=>E.getZIndex())),I.default.dispatch("Tools/HochWasserPrint/setVisibleLayerList",[].concat(...v))}}).call(this,p(3))},3829:function(B,Z,p){(function(T,G){var R=Object.create,N=Object.defineProperty,U=Object.getOwnPropertyDescriptor,H=Object.getOwnPropertyNames,k=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty,_=(o,r)=>{for(var l in r)N(o,l,{get:r[l],enumerable:!0})},P=(o,r,l,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let g of H(r))!J.call(o,g)&&g!==l&&N(o,g,{get:()=>r[g],enumerable:!(a=U(r,g))||a.enumerable});return o},D=(o,r,l)=>(l=o!=null?R(k(o)):{},P(r||!o||!o.__esModule?N(l,"default",{value:o,enumerable:!0}):l,o)),V=o=>P(N({},"__esModule",{value:!0}),o),h={};_(h,{default:()=>W,getLastPrintedExtent:()=>E}),B.exports=V(h);var L=p(107),I=D(p(284)),A=D(p(3874)),O=D(p(3828)),S=p(5),m=p(46);let v;function E(){return v}var W={retrieveCapabilites:function({state:o,dispatch:r,rootGetters:l,commit:a}){let g;o.serviceId!==""&&(g=l.getRestServiceById(o.serviceId).url,g.includes("/print/")||(g=g+"print/"),a("setServiceUrl",g),g=g+o.printAppId+"/"+o.printAppCapabilities,r("sendRequest",{serviceUrl:g,requestType:"GET",onSuccess:"parseCapabilities"}))},parseCapabilities:function({state:o,dispatch:r},l){o.printService==="mapfish"?r("parseMapfishCapabilities",l):r("parsePlotserviceCapabilities",l)},parseMapfishCapabilities:function({state:o,commit:r,dispatch:l},a){r("setLayoutList",a.layouts),l("chooseCurrentLayout",a.layouts),l("getAttributeInLayoutByName","scale"),r("setFormatList",o.formatList),r("setCurrentScale",T.request("MapView","getOptions").scale),l("togglePostrenderListener")},parsePlotserviceCapabilities:function({commit:o,dispatch:r},l){o("setLayoutList",l.layouts),r("chooseCurrentLayout",l.layouts),o("setScaleList",l.scales.map(a=>parseInt(a.value,10)).sort((a,g)=>a-g)),o("setFormatList",l.outputFormats.map(a=>a.name)),o("setCurrentScale",T.request("MapView","getOptions").scale),r("togglePostrenderListener")},chooseCurrentLayout:function({state:o,commit:r},l){const a=l.find(y=>y.name===o.currentLayoutName),g=a||l[0];r("setCurrentLayout",g),r("setCurrentLayoutName",g.name)},getAttributeInLayoutByName:function({state:o,commit:r},l){var a;Array.isArray((a=o.currentLayout)==null?void 0:a.attributes)&&o.currentLayout.attributes.forEach(g=>{if(g.name===l){const y=l.charAt(0).toUpperCase()+l.slice(1);r("setIs"+y+"Available",!0),r("set"+y+"Attribute",g)}})},togglePostrenderListener:function({state:o,dispatch:r,commit:l}){const a=[];if((0,O.default)(o.printMapMarker),a.length&&o.active&&r("Alerting/addSingleAlert",G.t("additional:modules.tools.hochWasserPrint.vtlWarning"),{root:!0}),l("setVisibleLayer",o.visibleLayerList),o.active&&o.layoutList.length!==0&&o.visibleLayerList.length>=1&&typeof o.eventListener>"u"&&o.maskStarted){const g=A.default.getCanvasLayer(o.visibleLayerList);l("setEventListener",g.on("postrender",y=>r("createPrintMask",y)))}else(!o.active||!o.maskStarted)&&(T.trigger("Map","unregisterListener",o.eventListener),l("setEventListener",void 0),o.invisibleLayer&&(r("setOriginalPrintLayer"),l("setHintInfo","")));r("getPrintMapScales"),mapCollection.getMap("2D").render()},setOriginalPrintLayer:function({state:o}){const r=o.invisibleLayer,l=o.currentMapScale,a=T.request("MapView","getResosolutionByScale",l,"max"),g=T.request("MapView","getResolutionByScale",l,"min");r.forEach(y=>{const x=T.request("ModelList","getModelByAttributes",{id:y.get("id")});a<=y.getMaxResolution()&&g>y.getMinResolution()?x.setIsOutOfRange(!1):x.setIsOutOfRange(!0),y.setVisible(!0)})},setPrintLayers:function({state:o,dispatch:r,commit:l},a){const g=o.visibleLayerList,y=T.request("MapView","getResolutionByScale",a,"max"),x=T.request("MapView","getResolutionByScale",a,"min"),C=[];let j="",F="";g.forEach(e=>{const t=T.request("ModelList","getModelByAttributes",{id:e.id});y>e.getMaxResolution()||x<e.getMinResolution()?(C.push(e),j+="- "+e.get("name")+"<br>",typeof t<"u"&&t.setIsOutOfRange(!0)):typeof t<"u"&&t.setIsOutOfRange(!1)}),F=G.t("additional:modules.tools.hochWasserPrint.invisibleLayer",{scale:"1: "+(0,I.default)(a," ")}),F=F+"<br>"+j,C.length&&F!==o.hintInfo&&(r("Alerting/addSingleAlert",F),l("setHintInfo",F)),C.length||l("setHintInfo",""),l("setInvisibleLayer",C)},updateCanvasLayer:function({state:o,commit:r,dispatch:l}){const a=o.visibleLayerList;let g={};T.trigger("Map","unregisterListener",o.eventListener),g=A.default.getCanvasLayer(a),l("chooseCurrentLayout",o.layoutList),Object.keys(g).length&&r("setEventListener",g.on("postrender",y=>{l("createPrintMask",y)}))},createPrintMask:function({dispatch:o,state:r},l){if(!r.maskStarted)return;o("getPrintMapSize");const a=l.frameState,g=l.context,y={frameState:l.frameState,context:l.context},x={pixelToCoordinateTransform:a.pixelToCoordinateTransform,mapSize:a.size,resolution:a.viewState.resolution,printMapSize:r.layoutMapInfo,scale:"",context:g},C={mapSize:a.size,resolution:a.viewState.resolution,printMapSize:r.layoutMapInfo,scaleList:r.scaleList};r.isScaleSelectedManually&&(x.scale=r.currentScale),r.autoAdjustScale?(o("getOptimalScale",C),x.scale=r.optimalScale):x.scale=r.currentScale,o("drawMask",y),o("drawPrintPage",x),g.fillStyle="rgba(0, 5, 25, 0.55)",g.fill(),o("setPrintLayers",x.scale)},getOptimalScale:function({commit:o,state:r},l){const a=l.mapSize[0]*l.resolution,g=l.mapSize[1]*l.resolution,y=a*r.INCHES_PER_METER*r.DOTS_PER_INCH/l.printMapSize[0],x=g*r.INCHES_PER_METER*r.DOTS_PER_INCH/l.printMapSize[1],C=Math.min(y,x);let j=l.scaleList[0];l.scaleList.forEach(F=>{C>F&&(j=F)}),o("setOptimalScale",j),o("setCurrentScale",j)},drawMask:function(o,r){const l=r.frameState.size,a=r.context,g=r.context.canvas.width>l[0]?L.DEVICE_PIXEL_RATIO:1,y=l[0]*g,x=l[1]*g;a.beginPath(),a.moveTo(0,0),a.lineTo(y,0),a.lineTo(y,x),a.lineTo(0,x),a.lineTo(0,0),a.closePath()},drawPrintPage:function({state:o},r){const l=r.context.canvas.width>r.mapSize[0]?L.DEVICE_PIXEL_RATIO:1,a=[r.mapSize[0]*l/2,r.mapSize[1]*l/2],g=r.printMapSize[0]/o.DOTS_PER_INCH/o.INCHES_PER_METER*r.scale/r.resolution*l,y=r.printMapSize[1]/o.DOTS_PER_INCH/o.INCHES_PER_METER*r.scale/r.resolution*l,x=a[0]-g/2,C=a[1]-y/2,j=a[0]+g/2,F=a[1]+y/2,e=(0,S.createEmpty)(),t=r.pixelToCoordinateTransform,i=(0,m.apply)(t,[x,C]),n=(0,m.apply)(t,[j,F]);r.context.moveTo(x,C),r.context.lineTo(x,F),r.context.lineTo(j,F),r.context.lineTo(j,C),r.context.lineTo(x,C),r.context.closePath(),(0,S.extendCoordinate)(e,i),(0,S.extendCoordinate)(e,n),v=e},getOptimalResolution:function({commit:o,state:r},l){const a=r.INCHES_PER_METER*r.DOTS_PER_INCH,g=l.printMapSize[0]*l.scale/(a*l.mapSize[0]),y=l.printMapSize[1]*l.scale/(a*l.mapSize[1]);o("setOptimalResolution",Math.max(g,y))},getPrintMapSize:function({state:o,commit:r,dispatch:l}){if(o.printService==="plotservice"){const a=o.currentLayout.map;r("setLayoutMapInfo",[a.width,a.height])}else{l("getAttributeInLayoutByName","map");const a=o.mapAttribute.clientInfo;r("setLayoutMapInfo",[a.width,a.height])}},getPrintMapScales:function({state:o,dispatch:r,commit:l}){var a;if(o.printService!=="plotservice"){r("getAttributeInLayoutByName","map");const g=(a=o.mapAttribute)==null?void 0:a.clientInfo;Array.isArray(g?.scales)&&l("setScaleList",g.scales.sort((y,x)=>y-x))}}}}).call(this,p(3),p(6))},3874:function(B,Z,p){(function(T){var G=Object.defineProperty,R=Object.getOwnPropertyDescriptor,N=Object.getOwnPropertyNames,U=Object.prototype.hasOwnProperty,H=(h,L)=>{for(var I in L)G(h,I,{get:L[I],enumerable:!0})},k=(h,L,I,A)=>{if(L&&typeof L=="object"||typeof L=="function")for(let O of N(L))!U.call(h,O)&&O!==I&&G(h,O,{get:()=>L[O],enumerable:!(A=R(L,O))||A.enumerable});return h},J=h=>k(G({},"__esModule",{value:!0}),h),_={};H(_,{default:()=>V}),B.exports=J(_);var P=p(151),V={getCanvasLayer:function(h){const L=T.request("MapView","getOptions").resolution;let I=[],A={};if(!Array.isArray(h))return h;h.forEach(O=>{O instanceof P.Group?O.getLayers().getArray().forEach(S=>{I.push(this.buildCanvasLayerType(S,L))}):I.push(this.buildCanvasLayerType(O,L))}),I=I.reverse();for(const O of I)if(typeof O<"u"){A=O;break}return A},buildCanvasLayerType:function(h,L){const I=T.request("MapView","getCurrentExtent"),A=h.getMinResolution(),O=h.getMaxResolution(),S=this.isInScaleRange(A,O,L);let m=[],v;return S&&(h instanceof P.Image||h instanceof P.Tile||h instanceof P.VectorTile?v=h:h instanceof P.Vector&&(m=h.getSource().getFeaturesInExtent(I),m.length>0&&(v=h))),v},isInScaleRange:function(h,L,I){let A=!1;return h<=I&&L>=I&&(A=!0),A}}}).call(this,p(3))},3894:function(B,Z,p){(function(T){var G=Object.create,R=Object.defineProperty,N=Object.getOwnPropertyDescriptor,U=Object.getOwnPropertyNames,H=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty,J=(e,t)=>{for(var i in t)R(e,i,{get:t[i],enumerable:!0})},_=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let u of U(t))!k.call(e,u)&&u!==i&&R(e,u,{get:()=>t[u],enumerable:!(n=N(t,u))||n.enumerable});return e},P=(e,t,i)=>(i=e!=null?G(H(e)):{},_(t||!e||!e.__esModule?R(i,"default",{value:e,enumerable:!0}):i,e)),D=e=>_(R({},"__esModule",{value:!0}),e),V=(e,t,i)=>new Promise((n,u)=>{var f=d=>{try{s(i.next(d))}catch(b){u(b)}},c=d=>{try{s(i.throw(d))}catch(b){u(b)}},s=d=>d.done?n(d.value):Promise.resolve(d.value).then(f,c);s((i=i.apply(e,t)).next())}),h={};J(h,{default:()=>F}),B.exports=D(h);var L=p(40),I=p(140),A=p(44),O=P(p(21)),S=p(58),m=p(151),v=P(p(7)),E=P(p(18)),W=P(p(1208)),o=P(p(167)),r=P(p(287)),l=p(285),a=p(2112),g=P(p(291)),y=p(3829),x=P(p(78)),C=p(827),F={defaults:{uniqueIdList:[],visibleLayerIds:null,layout:null,attributes:{map:null,printId:"",showLegend:!1,legend:"",gfi:null,scale:null}},setAttributes:function(e){this.defaults.attributes=e.attributes,this.defaults.layout=e.layout,this.defaults.outputFilename=e.outputFilename,this.defaults.outputFormat=e.outputFormat},isOwnMetaRequest:function(e,t){return Array.isArray(e)&&e.indexOf(t)!==-1},removeUniqueIdFromList:function(e,t){this.setUniqueIdList((0,W.default)(e,[t]))},parseAddressToString:function(e){let t,i=!1,n,u,f=!1,c,s="";return(0,E.default)(e)&&(t=e.street,i=this.isFilled(t),n=e.housenr,u=e.postalCode,f=this.isFilled(u),c=e.city),i&&(s+=t),this.isFilled(n)&&(i&&(s+=" "),s+=n),s!==""&&(s+=`
 `),f&&(s+=u),this.isFilled(c)&&(f&&(s+=" "),s+=c),s.trim()===""&&(s+="n.N."),s},isFilled:function(e){return typeof e<"u"&&e.trim()!==""},buildLayers:function(e){return V(this,null,function*(){var t;const i=[],n=this.defaults.attributes,u=(t=T.request("MapView","getOptions"))==null?void 0:t.resolution,f=[];if(Array.isArray(e))for(const c of e){const s=[];if(c instanceof m.Group)for(const d of c.getLayers().getArray())s.push(yield this.buildLayerType(d,u)),f.push(d.get("id"));else s.push(yield this.buildLayerType(c,u));s.forEach(d=>{typeof d<"u"&&(c?.get("id")!==void 0&&f.push(c?.get("id")),i.push(d))})}this.setVisibleLayerIds(f),n.map.layers=i.reverse()})},getDrawLayerInfo:function(e,t){const i=e.getSource().getFeaturesInExtent(t),n=(0,o.default)(i,function(f){return f.getStyle()&&typeof f.getStyle=="function"&&typeof f.getStyle().getZIndex=="function"?f.getStyle().getZIndex():0}),u=n.filter(f=>f.get("isVisible"));if(u.length>0)return this.buildVector(e,u)},buildLayerType:function(e,t){return V(this,null,function*(){const i=T.request("MapView","getCurrentExtent"),n=typeof e?.get=="function"?e.get("minResolution"):!1,u=typeof e?.get=="function"?e.get("maxResolution"):!1,f=this.isInScaleRange(n,u,t);let c=[],s;if(f){const d=e.getSource();if(e instanceof g.default){const b=(0,y.getLastPrintedExtent)();s=yield this.buildVectorTile(e,t,b)}else e instanceof m.Image?s=this.buildImageWms(e):e instanceof m.Tile?d?.getParams?s=this.buildTileWms(e):d?.getLayer&&(s=this.buildWmts(e,d)):typeof e?.get=="function"&&e.get("name")==="importDrawLayer"?s=this.getDrawLayerInfo(e,i):e instanceof m.Vector&&(c=d.getFeaturesInExtent(i),c.length>0&&(s=this.buildVector(e,c)))}return s})},isInScaleRange:function(e,t,i){let n=!1;return e<=i&&t>=i&&(n=!0),n},buildWmts:(e,t)=>{const i=[],n=t.getTileGrid(),u=n.getMatrixIds(),{origin_:f,origins_:c,tileSize_:s,tileSizes_:d}=n;let b=t.getUrls()[0];for(let M=0;M<u.length;M++)i.push({identifier:u[M],matrixSize:t.matrixSizes[M],topLeftCorner:f||c[M],scaleDenominator:t.scales[M],tileSize:s?[s,s]:[d[M],d[M]]});return b.includes("{Style}")&&(b=b.replace(/{Style}/g,"{style}")),{baseURL:b,opacity:e.getOpacity(),type:"WMTS",layer:t.getLayer(),style:t.getStyle(),imageFormat:t.getFormat(),matrixSet:t.getMatrixSet(),matrices:i,requestEncoding:t.getRequestEncoding()}},buildVectorTile:function(e,t,i){return V(this,null,function*(){a.MVTEncoder.useImmediateAPI=!1;const n=v.default.state.Tools.HochWasserPrint.layoutMapInfo,u=v.default.state.Tools.HochWasserPrint.dpiForPdf,f=u/72,c=n[0]*f,s=n[1]*f,d=new a.MVTEncoder,b=yield d.encodeMVTLayer({layer:e,tileResolution:t,printResolution:t,printExtent:i,canvasSize:[c,s]}),{extent:M,baseURL:z}=b[0];if(b.length!==1)throw new Error("handle several results");return b[0].baseURL.length<=6?null:{extent:M,baseURL:z,type:"image",name:e.get("name"),opacity:1,imageFormat:"image/png"}})},buildTileWms:function(e){const t=e.getSource(),i={baseURL:t.getUrls()[0],opacity:e.getOpacity(),type:"WMS",layers:t.getParams().LAYERS.split(","),styles:t.getParams().STYLES?t.getParams().STYLES.split(","):void 0,imageFormat:t.getParams().FORMAT,customParams:{TRANSPARENT:t.getParams().TRANSPARENT,DPI:v.default.state.Tools.HochWasserPrint.dpiForPdf}};return Object.prototype.hasOwnProperty.call(t.getParams(),"SLD_BODY")&&t.getParams().SLD_BODY!==void 0&&(i.customParams.SLD_BODY=t.getParams().SLD_BODY,i.styles=["style"]),i},buildImageWms:function(e){const t=e.getSource();return{baseURL:t.getUrl(),opacity:e.getOpacity(),type:"WMS",layers:t.getParams().LAYERS.split(","),styles:t.getParams().STYLES?t.getParams().STYLES.split(","):void 0,imageFormat:t.getParams().FORMAT,customParams:{TRANSPARENT:t.getParams().TRANSPARENT,DPI:v.default.state.Tools.HochWasserPrint.dpiForPdf}}},buildVector:function(e,t){const i=[];return{type:"geojson",style:this.buildStyle(e,t,i),geojson:i}},buildStyle:function(e,t,i){const n={version:"2"};return t.reverse().forEach(u=>{const f=this.getFeatureStyle(u,e),c=this.getStyleAttributes(e,u);let s,d,b,M,z,$;f.forEach((w,q)=>{if(w!==null){const X=this.getStyleModel(e);let K=",";if(s=u.clone(),c.forEach(Y=>{s.set(Y,(s.get("features")?s.get("features")[0]:s).get(Y)+"_"+String(q))}),z=u.getGeometry().getType(),$=w.getGeometryFunction(),$!=null&&(s.setGeometry($(s)),z=$(s).getType()),d=this.getStylingRules(e,s,c,w),typeof X<"u"&&X.get("labelField")&&X.get("labelField").length>0&&(d=d.replaceAll(K," AND "),K=" AND "),b=d.replaceAll("[","").replaceAll("]","").replaceAll("*","").split(K).map(Y=>Y.split("=")),Array.isArray(b)&&b.length&&this.unsetStringPropertiesOfFeature(s,b.reduce((Y,Q)=>Array.isArray(Q)&&Q.length?[...Y,Q[0]]:Y,[])),this.addFeatureToGeoJsonList(s,i,w),Object.prototype.hasOwnProperty.call(n,d))return;M={symbolizers:[]},z==="Point"||z==="MultiPoint"?(w.getImage()!==null||w.getText()!==null)&&M.symbolizers.push(this.buildPointStyle(w,e)):z==="Polygon"||z==="MultiPolygon"?M.symbolizers.push(this.buildPolygonStyle(w,e)):z==="Circle"?M.symbolizers.push(this.buildPolygonStyle(w,e)):(z==="LineString"||z==="MultiLineString")&&M.symbolizers.push(this.buildLineStringStyle(w,e)),w.getText()!==null&&w.getText()!==void 0&&M.symbolizers.push(this.buildTextStyle(w.getText())),n[d]=M}})}),n},getStyleModel(e){const t=T.request("ModelList","getModelByAttributes",{id:e?.get("id")});if(typeof t?.get=="function")return x.default.returnStyleObject(t.get("styleId"))},unsetStringPropertiesOfFeature:function(e,t){Object.keys(e.getProperties()).forEach(i=>{const n=e.getProperties()[i];!t.includes(i)&&typeof n=="string"&&e.unset(i,{silent:!0})})},buildPointStyle:function(e,t){return e.getImage()instanceof L.Circle?this.buildPointStyleCircle(e.getImage()):e.getImage()instanceof L.Icon&&e.getImage().getScale()>0?this.buildPointStyleIcon(e.getImage(),t):this.buildTextStyle(e.getText())},buildPointStyleCircle:function(e){const t=e.getFill(),i=e.getStroke(),n={type:"point",pointRadius:e.getRadius()};return t!==null&&(this.buildFillStyle(t,n),this.buildStrokeStyle(t,n)),i!==null&&this.buildStrokeStyle(i,n),n},buildPointStyleIcon:function(e,t){return{type:"point",graphicWidth:e.getSize()[0]?e.getSize()[0]*e.getScale():60,graphicHeight:e.getSize()[1]?e.getSize()[1]*e.getScale():60,externalGraphic:this.buildGraphicPath(e.getSrc()),graphicOpacity:t.getOpacity()}},buildGraphicPath:function(e){const t=window.location.origin;let i=Config.wfsImgPath+this.getImageName(e);return e.indexOf("http")===0&&e.indexOf("localhost")===-1?i=e:e.charAt(0)==="/"?i=t+e:e.indexOf("../")===0?i=new URL(e,window.location.href).href:t.indexOf("localhost")===-1?i=t+"/lgv-config/img/"+this.getImageName(e):e.indexOf("data:image/svg+xml;charset=utf-8")===0&&(i=e),i},buildTextStyle:function(e){const t=e.getFont()?e.getFont():"bold 16px Helvetica",i=this.getFontSize(t),n=i!==null,u=e.getScale()?e.getScale():1,f=n?i:10*u,c=n?this.getFontFamily(t,f):t,s=e.getFill().getColor(),d=e.getStroke()?e.getStroke():void 0;return{type:"text",label:"[_label]",fontColor:(0,l.convertColor)(s,"hex"),fontOpacity:s[0]!=="#"?s[3]:1,labelOutlineColor:d?(0,l.convertColor)(d.getColor(),"hex"):void 0,labelOutlineWidth:d?d.getWidth():void 0,labelXOffset:e.getOffsetX(),labelYOffset:-e.getOffsetY(),fontSize:f,fontFamily:c,labelAlign:this.getLabelAlign(e)}},getFontFamily:function(e,t){const i=e?e.indexOf(" ",e.indexOf(t)):-1;return i>-1?e.substring(i+1):""},getFontSize:function(e){const t=e?e.match(/\d/g):null;return Array.isArray(t)&&t.length>0?t.join(""):null},getLabelAlign:function(e){const t=e.getTextAlign();return t==="left"?"lb":t==="right"?"rb":t==="center"?"cm":"cb"},buildPolygonStyle:function(e,t){const i=e.getFill(),n=e.getStroke(),u={type:"polygon",fillOpacity:t.getOpacity(),strokeOpacity:t.getOpacity()};return i!==null&&this.buildFillStyle(i,u),n!==null&&this.buildStrokeStyle(n,u),u},buildLineStringStyle:function(e,t){const i=e.getStroke(),n={type:"line",strokeOpacity:t.getOpacity()};return i!==null&&this.buildStrokeStyle(i,n),n},buildFillStyle:function(e,t){let i=e.getColor();return typeof i=="string"&&(i=this.colorStringToRgbArray(i)),t.fillColor=(0,l.convertColor)(i,"hex"),t.fillOpacity=i[3],t},colorStringToRgbArray:function(e){const t=e;let i;return t.match(/^(rgb)/)&&(i=this.rgbStringToRgbArray(t)),i},rgbStringToRgbArray:function(e){const t=e.indexOf("(")+1,i=e.indexOf(")"),n=i-t,u=e.substr(t,n),f=u.split(","),c=[];return f.forEach(function(s){s.trim(),c.push(parseFloat(s))}),c},buildStrokeStyle:function(e,t){const i=e.getColor();return t.strokeColor=(0,l.convertColor)(i,"hex"),Array.isArray(i)&&typeof i[3]<"u"&&(t.strokeOpacity=i[3]),typeof e.getWidth=="function"&&typeof e.getWidth()<"u"&&(t.strokeWidth=e.getWidth()),t},getImageName:function(e){const t=e.lastIndexOf("/");return e.indexOf("/")!==-1?e.substr(t+1):"/"+e},addFeatureToGeoJsonList:function(e,t,i){let n;e.get("features")&&e.get("features").length===1?e.get("features").forEach(u=>{n=this.convertFeatureToGeoJson(u,i),n&&t.push(n)}):(n=this.convertFeatureToGeoJson(e,i),n&&t.push(n))},convertFeatureToGeoJson:function(e,t){var i;const n=e.clone(),u=new S.GeoJSON,f=((i=t.getText())==null?void 0:i.getText())||"";let c;return Object.keys(n.getProperties()).forEach(s=>{((0,E.default)(n.get(s))&&!(n.get(s)instanceof r.default)||Array.isArray(n.get(s)))&&n.unset(s)}),n.setId(e.getId()||e.ol_uid),n.set("_label",f),n.getGeometry().getType()==="Circle"&&n.setGeometry((0,A.fromCircle)(n.getGeometry())),n.unset("Datastreams",{silent:!0}),c=u.writeFeatureObject(n),n.getGeometry().getCoordinates().length===0&&(c=void 0),c?.properties&&Object.prototype.hasOwnProperty.call(c.properties,"features")&&delete c.properties.features,c},getFeatureStyle:function(e,t){let i;if(typeof e.getStyleFunction()<"u")try{i=e.getStyleFunction().call(e)}catch{i=e.getStyleFunction().call(this,e)}else i=t.getStyleFunction().call(t,e);return Array.isArray(i)?i:[i]},getStylingRules:function(e,t,i,n,u){const f=t.get("styleId")?"styleId":i,c=this.getStyleModel(e);if(f.length===1&&f[0]===""){if(t.get("features")&&t.get("features").length===1){const s=new O.default({properties:t.get("features")[0].getProperties(),geometry:t.get("features")[0].getGeometry()});return t.get("features")[0]=s,n.getImage().getSrc().indexOf("data:image/svg+xml;charset=utf-8")===0?s.setId("first_svg_"+s.ol_uid):s.setId("second_png_"+s.ol_uid),s.set(s.getId(),String(t.get("features").length)),"["+s.getId()+"='"+String(t.get("features").length)+"']"}return typeof t.get("features")<"u"&&typeof n<"u"&&typeof n.getText().getText()<"u"?(t.set("sensorClusterStyle",t.get("features")[0].ol_uid+"_"+String(n.getText().getText())),"[sensorClusterStyle='"+t.get("features")[0].ol_uid+"_"+String(n.getText().getText())+"']"):this.getFeatureStyle(t,e).length>1?(n.getImage().getSrc().indexOf("data:image/svg+xml;charset=utf-8")===0?t.setId("first_svg_"+t.ol_uid):t.setId("second_png_"+t.ol_uid),Object.keys(t.getProperties()).forEach(s=>{s===""&&t.unset(s)}),t.set(t.getId(),String(u)),"["+t.getId()+"='"+String(u)+"']"):"*"}if(typeof t.get("features")<"u"){if(typeof n<"u"&&typeof n.getText().getText()<"u"||t.get("features").length>1){const s=t.get("features")[0].get(f[0])+"_"+typeof n!="undefined"&&typeof n.getText().getText()<"u"?n.getText().getText():"cluster";return t.set(f[0],s),`[${f[0]}='${s}']`}return f.reduce((s,d)=>{const b=t.get("features")[0].get(d);return t.set(d,b),s+`${d}='${b}',`},"[").slice(0,-1)+"]"}if(typeof c<"u"&&c.get("labelField")&&c.get("labelField").length>0){const s=c.get("labelField");return f.reduce((d,b)=>d+`${b}='${t.get(b)}' AND ${s}='${t.get(s)}',`,"[").slice(0,-1)+"]"}return f instanceof Array?f.reduce((s,d)=>s+`${d}='${t.get(d)}',`,"[").slice(0,-1)+"]":"["+f+"='"+t.get(f)+"']"},getStyleAttributes:function(e,t){var i;const n=e.get("id"),u=this.getStyleModel(e);let f=["styleId"],c=T.request("ModelList","getModelByAttributes",{id:e.get("id")});if(typeof u<"u")if(c=this.getChildModelIfGroupLayer(c,n),c.get("styleId")){const s=(0,C.getRulesForFeature)(u,t);f=(i=s?.[0])!=null&&i.conditions?Object.keys(s[0].conditions.properties):[""]}else f=[u.get("styleField")];return f},getChildModelIfGroupLayer:function(e,t){let i=e;return i.get("typ")==="GROUP"&&(i=i.get("layerSource").filter(n=>n.get("id")===t)[0]),i},legendContainsPdf:function(e){return e.some(t=>{let i=!1;if(typeof t=="object"&&!Array.isArray(t.graphic))i=t.graphic.endsWith(".pdf");else{if(typeof t=="object"&&Array.isArray(t.graphic))return i;i=t.endsWith(".pdf")}return i})},prepareLegendAttributes:function(e){const t=[];return e.forEach(i=>{const n={legendType:"",geometryType:"",imageUrl:"",color:"",label:i.name},u=typeof i=="object"?i.graphic:i;Array.isArray(u)?(u.forEach(f=>{f.indexOf("svg")!==-1?n.svg=decodeURIComponent(f).split("data:image/svg+xml;charset=utf-8,")[1]:n.imageUrl=f}),n.legendType="svgAndPng"):u.indexOf("data:image/svg+xml;charset=utf-8,<svg")!==-1?(n.svg=decodeURIComponent(u).split("data:image/svg+xml;charset=utf-8,")[1],n.legendType="svg"):u.toUpperCase().includes("GETLEGENDGRAPHIC")?(n.legendType="wmsGetLegendGraphic",n.imageUrl=u):u.indexOf("<svg")!==-1?(n.color=this.getFillColorFromSVG(u),n.legendType="geometry",n.geometryType="polygon"):(n.legendType="wfsImage",n.imageUrl=u),typeof n.color<"u"&&t.push(n)}),[].concat(...t)},getFillColorFromSVG:function(e){if(e.split(/fill:(.+)/)[1])return e.split(/fill:(.+)/)[1].split(/;(.+)/)[0]},buildGfi:function(e,t){const i={};let n,u;e&&(t.length>0&&(i.layers=[],n=t[0],u=t[1],i.layers.push({layerName:u,values:this.prepareGfiAttributes(n)})),this.addGfiFeature(this.defaults.attributes.map.layers,t[2])),this.setShowGfi(e),this.setGfi(i)},addGfiFeature:function(e,t){const i=new S.GeoJSON,n=new O.default({geometry:new I.Point(t),name:"GFI Point"});e.splice(0,0,{type:"geojson",geojson:[i.writeFeatureObject(n)],style:{version:"2","[name='GFI Point']":{symbolizers:[{fillOpacity:0,pointRadius:18,strokeColor:"#e10019",strokeWidth:3,type:"point"},{fillColor:"#e10019",pointRadius:4,strokeOpacity:0,type:"point"}]}}})},prepareGfiAttributes:function(e){const t=[];let i;for(i in e)t.push({key:i,value:e[i]});return t},buildScale:function(e){const t="1:"+e;this.setScale(t)},setMetadata:function(e){this.defaults.attributes.metadata=e},setLegend:function(e){this.defaults.attributes.legend=e},setShowGfi:function(e){this.defaults.attributes.showGfi=e},setGfi:function(e){this.defaults.attributes.gfi=e},setScale:function(e){this.defaults.attributes.scale=e},setUniqueIdList:function(e){this.defaults.uniqueIdList=e},setVisibleLayerIds:function(e){this.defaults.visibleLayerIds=e}}}).call(this,p(3))}}]);
