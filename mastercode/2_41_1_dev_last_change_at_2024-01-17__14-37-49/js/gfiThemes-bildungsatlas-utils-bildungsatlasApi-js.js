(window.webpackJsonp=window.webpackJsonp||[]).push([[26,532],{3740:function(U,K,w){var V=Object.create,b=Object.defineProperty,z=Object.getOwnPropertyDescriptor,W=Object.getOwnPropertyNames,M=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,I=(e,s)=>{for(var r in s)b(e,r,{get:s[r],enumerable:!0})},x=(e,s,r,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of W(s))!R.call(e,i)&&i!==r&&b(e,i,{get:()=>s[i],enumerable:!(o=z(s,i))||o.enumerable});return e},j=(e,s,r)=>(r=e!=null?V(M(e)):{},x(s||!e||!e.__esModule?b(r,"default",{value:e,enumerable:!0}):r,e)),G=e=>x(b({},"__esModule",{value:!0}),e),P={};I(P,{changeMetadata:()=>$,cloneComplexType:()=>d,compareComplexTypesAndFillDataGaps:()=>c,confineComplexTypeArrayValues:()=>h,confineComplexTypeValues:()=>f,convertComplexTypeToBarchart:()=>l,convertComplexTypeToLinechart:()=>a,convertComplexTypeToPiechart:()=>t,convertComplexTypesToMultilinechart:()=>n,hasComplexTypeValues:()=>Y,isComplexType:()=>u,optimizeComplexTypeValues:()=>_,optimizeValueRootedInComplexType:()=>E,sortComplexType:()=>O,sortComplexTypes:()=>v}),U.exports=G(P);var g=w(285),A=j(w(53));function _(e,s=!1){if(!u(e))return e;const r=d(e);return r.values.forEach(o=>{o.value=E(o.value,s)}),r}function E(e,s=!1){const r=typeof s=="number"?Math.pow(10,s):!1;let o=e;return typeof o=="number"&&r!==!1?o=Math.round(o*r)/r:typeof o=="string"&&(o.indexOf(",")!==-1&&(o=o.replace(/,/,".")),s!==!1?o=Math.round(parseFloat(o)*r)/r:o=Number(o)),o}function $(e,s,r){return!u(e)||typeof s!="string"?!1:(e.metadata[s]=r,!0)}function f(e,s=10){const r=d(e);return typeof s=="number"&&u(r)&&r.values.length>s&&(r.values=r.values.slice(-s)),r}function h(e){const s=d(e),r=[];return Array.isArray(s)&&s.forEach(o=>{r.push(f(o))}),r.length===0?s:r}function t(e,s=null,r=!1){if(!u(e))return!1;const o=[],i=[],y=e.metadata.description?e.metadata.description:"",p=[],S=Array.isArray(r)&&r.length?r:[[230,159,0,1],[86,180,233,1],[0,158,115,1],[240,228,66,1],[0,114,178,1],[213,94,0,1],[204,121,167,1]];return e.values.forEach((C,F)=>{typeof C=="object"&&C!==null&&C.key&&C.value&&(o.push(C.value),i.push(C.key),p.push((0,g.convertColor)(S[F%S.length],"rgbaString")))}),{datasets:[Object.assign({label:y,data:o,backgroundColor:p,hoverOffset:4},s)],labels:i}}function a(e,s=null,r="#005ca9"){return u(e)?n([e],s,[r]):!1}function n(e,s=null,r=!1){if(!Array.isArray(e))return!1;const o=[],i=[],y=Array.isArray(r)&&r.length?r:[[46,127,210,1],[255,217,102,1],[13,86,163,1],[255,130,102,1],[0,48,99,1],[230,159,0,1],[86,180,233,1]];return e.forEach((p,S)=>{if(!u(p))return;const C=[],F=[],J=p.metadata.description?p.metadata.description:"";p.values.forEach(T=>{typeof T=="object"&&T!==null&&T.key&&(F.push(T.key),C.push(typeof T.value=="number"||T.value?T.value:null))}),o.push(F),i.push(Object.assign({label:J,data:C,borderColor:(0,g.convertColor)(y[S%y.length],"rgbaString"),backgroundColor:(0,g.convertColor)(y[S%y.length],"rgbaString"),spanGaps:!1,fill:!1,borderWidth:2,pointRadius:4,pointHoverRadius:4,lineTension:0},s))}),!Array.isArray(o)||!o.length||!Array.isArray(i)||!i.length?!1:{datasets:i,labels:L(o)}}function l(e,s=null){if(!u(e))return!1;const r=e.metadata.description?e.metadata.description:"",o=[],i=[];return e.values.forEach(y=>{typeof y=="object"&&y!==null&&y.key&&(o.push(y.value),i.push(y.key))}),s?.backgroundColor&&(s.backgroundColor=(0,g.convertColor)(s.backgroundColor,"rgbaString")),s?.hoverBackgroundColor&&(s.hoverBackgroundColor=(0,g.convertColor)(s.hoverBackgroundColor,"rgbaString")),{datasets:[Object.assign({label:r,data:o,backgroundColor:(0,g.convertColor)("#003063","rgbaString"),hoverBackgroundColor:(0,g.convertColor)("#B5D8FA","rgbaString"),borderWidth:1},s)],labels:i}}function u(e){return typeof e=="object"&&e!==null&&typeof e.metadata=="object"&&e.metadata!==null&&typeof e.metadata.type=="string"&&typeof e.metadata.format=="string"&&Array.isArray(e.values)}function c(e,s=null){if(!Array.isArray(e))return e;const r={},o=[];return e.forEach((i,y)=>{u(i)&&i.values.forEach(p=>{typeof p=="object"&&p!==null&&p?.key&&(r[p.key]=!0,Object.prototype.hasOwnProperty.call(o,y)||(o[y]={}),p?.value&&(o[y][p.key]=p.value))})}),e.forEach((i,y)=>{u(i)&&(i.values=[],Object.keys(r).forEach(p=>{Object.prototype.hasOwnProperty.call(o[y],p)?i.values.push({key:p,value:o[y][p]}):i.values.push({key:p,value:s})}))}),e}function v(e,s=!1){if(!Array.isArray(e))return e;const r=[];return e.forEach(o=>{r.push(O(o,s))}),r}function O(e,s=!1){if(!u(e))return!1;const r=d(e);return typeof s=="function"?(r.values.sort(s),r):r.metadata.type==="timeseries"?(m(r,r.metadata.format),r):(k(r),r)}function d(e){if(!u(e))return e;const s={metadata:{type:e.metadata.type,format:e.metadata.format,description:e.metadata.description},values:[]};return e.values.forEach(r=>{s.values.push({key:r.key,value:r.value})}),s}function k(e){return e.values.sort((s,r)=>typeof s!="object"||s===null||!Object.prototype.hasOwnProperty.call(s,"key")?1:typeof r!="object"||r===null||!Object.prototype.hasOwnProperty.call(r,"key")||s.key<r.key?-1:s.key>r.key?1:0)}function m(e,s){return e.values.sort((r,o)=>typeof r!="object"||r===null||!Object.prototype.hasOwnProperty.call(r,"key")?1:typeof o!="object"||o===null||!Object.prototype.hasOwnProperty.call(o,"key")?-1:(0,A.default)(r.key,s).diff((0,A.default)(o.key,s)))}function L(e){if(!Array.isArray(e))return!1;let s=0,r=!1;return e.forEach(o=>{if(!Array.isArray(o))return;const i=o.length;i>s&&(s=i,r=o)}),r}function Y(e){if(!u(e))return!1;const s=e.values.length;let r=0;for(r=0;r<s;r++)if(typeof e.values[r].value=="number"||typeof e.values[r].value=="string"&&e.values[r].value)return!0;return!1}},4011:function(U,K,w){var V=Object.create,b=Object.defineProperty,z=Object.getOwnPropertyDescriptor,W=Object.getOwnPropertyNames,M=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,I=(h,t)=>{for(var a in t)b(h,a,{get:t[a],enumerable:!0})},x=(h,t,a,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of W(t))!R.call(h,l)&&l!==a&&b(h,l,{get:()=>t[l],enumerable:!(n=z(t,l))||n.enumerable});return h},j=(h,t,a)=>(a=h!=null?V(M(h)):{},x(t||!h||!h.__esModule?b(a,"default",{value:h,enumerable:!0}):a,h)),G=h=>x(b({},"__esModule",{value:!0}),h),P={};I(P,{BildungsatlasApi:()=>f}),U.exports=G(P);var g=w(58),A=j(w(21)),_=j(w(25)),E=j(w(821)),$=w(3740);class f{constructor(t,a=!1,n=!1,l=!1,u=!1){if(!u){if(f.instance instanceof f)return f.instance;f.instance=this}f.startupCallbacks=[],this.wfsUrls=a,this.featureTypes=n,this.mockWfsCall=l,this.cache={},this.initConfig(t)}getComplexTypeStadt(t,a,n){this.getComplexType(t,f.KEY_BEZIRK,"bezirk_id","0",a,n)}getComplexTypeBezirk(t,a,n,l){this.getComplexType(t,f.KEY_BEZIRK,"bezirk_id",String(a),n,l)}getComplexTypeStadtteil(t,a,n,l){this.getComplexType(t,f.KEY_STADTTEIL,"stadtteil_id",String(a),n,l)}getComplexTypeSozialraum(t,a,n,l){this.getComplexType(t,f.KEY_SOZIALRAUM,"sozialraum_id",String(a),n,l)}getComplexTypeStatistischeGebiete(t,a,n,l){this.getComplexType(t,f.KEY_STATGEB,"statgeb_id",String(a),n,l)}getValueStadt(t,a,n){this.getComplexTypeStadt(t,l=>{a(l.values[0].value)},n)}getValueBezirk(t,a,n,l){this.getComplexTypeBezirk(t,a,u=>{n(u.values[0].value)},l)}getValueStadtteil(t,a,n,l){this.getComplexTypeStadtteil(t,a,u=>{n(u.values[0].value)},l)}getValueSozialraum(t,a,n,l){this.getComplexTypeSozialraum(t,a,u=>{n(u.values[0].value)},l)}getValueStatistischeGebiete(t,a,n,l){this.getComplexTypeStatistischeGebiete(t,a,u=>{n(u.values[0].value)},l)}getComplexType(t,a,n,l,u,c){if(this.wfsUrls===!1||this.featureTypes===!1){f.startupCallbacks.push(()=>{this.getComplexType(t,a,n,l,u,c)});return}if(!this.hasFeatureType(a,t)){typeof c=="function"&&c(new Error("bildungsatlasApi.getComplexType: unknown propertyName "+t));return}const v=this.featureTypes[a][t],O=this.getWfsPayload({featureType:v,propertyName:t,valueReference:n,literal:l});if(!this.hasWfsUrl(v)){typeof c=="function"&&c(new Error("bildungsatlasApi.getComplexType: featuerType not known by wfs urls "+v+" (see: "+t+")"));return}this.callWfs(this.wfsUrls[v],O,d=>{const k=this.convertXmlToFeatureCollection(d,v),m=this.filterComplexTypeFromJsonResponse(k,t);(0,$.isComplexType)(m)||c(new Error("bildungsatlasApi.getComplexType: the received structure isn't a ComplexType: "+v+" (see: "+t+") "+JSON.stringify(m))),u(m)},c)}getEinzugsgebieteValue(t,a,n,l,u){if(this.wfsUrls===!1||this.featureTypes===!1){f.startupCallbacks.push(()=>{this.getEinzugsgebieteValue(t,a,n,l,u)});return}const c=this.wfsUrls[t],v="https://registry.gdi-de.org/id/de.hh.up",O=new g.WFS({featureNS:v,featureType:t.substr(t.indexOf(":")+1)}),d=`<?xml version='1.0' encoding='UTF-8' ?>
<wfs:GetFeature service='WFS' version='1.1.0' xmlns:app='http://www.deegree.org/app' xmlns:wfs='http://www.opengis.net/wfs' xmlns:ogc='http://www.opengis.net/ogc'>
    <wfs:Query typeName='${t}'>
        <ogc:Filter>
            <ogc:PropertyIsEqualTo>
                <ogc:PropertyName>${a}</ogc:PropertyName>
                <ogc:Literal>${n}</ogc:Literal>
            </ogc:PropertyIsEqualTo>
        </ogc:Filter>
    </wfs:Query>
</wfs:GetFeature>`;if(!this.hasWfsUrl(t)){typeof u=="function"&&u(new Error("bildungsatlasApi.getEinzugsgebieteValue: featuerType not known by wfs urls "+t+" (see: "+a+")"));return}this.callWfs(c,d,k=>{const m=O.readFeatures(k);l(m)},u)}filterComplexTypeFromJsonResponse(t,a){if(!Array.isArray(t)||!t.length)return!1;const n=t[0],l=n instanceof A.default?n.get(a):!1;return typeof l=="object"&&l!==null&&typeof l.values=="object"&&l.values!==null&&!Array.isArray(l.values)&&(l.values=[l.values]),l}hasFeatureType(t,a){return typeof this.featureTypes=="object"&&this.featureTypes!==null&&Object.prototype.hasOwnProperty.call(this.featureTypes,t)&&typeof this.featureTypes[t]=="object"&&this.featureTypes[t]!==null&&Object.prototype.hasOwnProperty.call(this.featureTypes[t],a)&&typeof this.featureTypes[t][a]=="string"}hasWfsUrl(t){return Object.prototype.hasOwnProperty.call(this.wfsUrls,t)&&typeof this.wfsUrls[t]=="string"}callWfs(t,a,n,l){if(typeof this.mockWfsCall=="function"){this.mockWfsCall(t,a,n,l);return}const u=E.default.sha1(t+"_"+a);if(Object.prototype.hasOwnProperty.call(this.cache,u)){n(this.cache[u]);return}_.default.post(t,a,{headers:{"Content-Type":"text/xml"}}).then(c=>{this.cache[u]=c?.data,n(c?.data)}).catch(c=>l(c))}convertXmlToFeatureCollection(t,a,n="https://registry.gdi-de.org/id/de.hh.up"){const l=new g.WFS({featureNS:n,featureType:a.substr(a.indexOf(":")+1)}),u=t.replaceAll("wfs:member","gml:featureMember"),c=u.substr(0,u.indexOf("<de.hh.up:geom>")),v=u.substr(u.indexOf("</de.hh.up:geom>")+16);return l.readFeatures(c+v)}getWfsPayload(t){const a=Object.assign({featureType:"",propertyName:"",valueReference:"",literal:"",namespace:"de.hh.up",namespaceUrl:"https://registry.gdi-de.org/id/de.hh.up",service:"WFS",version:"2.0.0"},t);return`<?xml version="1.0" ?>
        <GetFeature
            service="${a.service}"
            version="${a.version}"
            resolveDepth="*"
            outputFormat="application/gml+xml; version=3.1"
            xmlns="http://www.opengis.net/wfs/2.0"
            xmlns:fes="http://www.opengis.net/fes/2.0"
            xmlns:${a.namespace}="${a.namespaceUrl}"
        >
            <Query typeNames="${a.featureType}">
                <PropertyName resolve="local">${a.namespace}:${a.propertyName}</PropertyName>
                <fes:Filter>
                    <fes:PropertyIsEqualTo>
                        <fes:ValueReference>${a.namespace}:${a.valueReference}</fes:ValueReference>
                        <fes:Literal>${a.literal}</fes:Literal>
                    </fes:PropertyIsEqualTo>
                </fes:Filter>
            </Query>
        </GetFeature>`}callWhenInitialized(t){this.wfsUrls!==!1&&this.featureTypes!==!1?typeof t=="function"&&t():f.startupCallbacks.push(t)}initConfig(t){this.wfsUrls!==!1&&this.featureTypes!==!1||typeof t!="string"||_.default.get(t,{headers:{"Content-Type":"application/json"}}).then(a=>{if(typeof a.data!="object"||a.data===null||!Object.prototype.hasOwnProperty.call(a.data,"wfsUrls")||!Object.prototype.hasOwnProperty.call(a.data,"featureTypes")){console.error("initConfig: the config data must include wfsUrls and featureTypes, api isn't able to process any data");return}this.wfsUrls=a.data.wfsUrls,this.featureTypes=a.data.featureTypes,f.startupCallbacks.forEach(n=>{typeof n=="function"&&n()}),f.startupCallbacks=[]}).catch(a=>{console.error(a)})}}f.KEY_BEZIRK="bezirk",f.KEY_STADTTEIL="stadtteil",f.KEY_SOZIALRAUM="sozialraum",f.KEY_STATGEB="statistischeGebiete"}}]);
