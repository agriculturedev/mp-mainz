(window.webpackJsonp=window.webpackJsonp||[]).push([[238],{3907:function(C,D,u){var P=Object.create,h=Object.defineProperty,x=Object.getOwnPropertyDescriptor,L=Object.getOwnPropertyNames,N=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty,M=(c,e)=>{for(var t in e)h(c,t,{get:e[t],enumerable:!0})},w=(c,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of L(e))!E.call(c,a)&&a!==t&&h(c,a,{get:()=>e[a],enumerable:!(r=x(e,a))||r.enumerable});return c},d=(c,e,t)=>(t=c!=null?P(N(c)):{},w(e||!c||!c.__esModule?h(t,"default",{value:c,enumerable:!0}):t,c)),j=c=>w(h({},"__esModule",{value:!0}),c),F={};M(F,{CommuterApi:()=>k}),C.exports=j(F);var T=u(58),g=d(u(68)),b=d(u(25)),O=d(u(821));class k{constructor(e={}){this.cache={},this.options=Object.assign({useProxy:!1,blacklistedDistricts:[],serviceUrl:""},e)}getListDistricts(e,t){const r=this.options.useProxy?(0,g.default)(this.options.serviceUrl):this.options.serviceUrl;r&&this.getFeatureCall(r,{typename:"app:mrh_kreise",maxFeatures:"10000"},a=>{const s=this.parseResponseGetFeature(a,"app:mrh_kreise","app:kreisname",this.options.blacklistedDistricts);s.sort((i,n)=>i<n?-1:i>n?1:0),e(s)},t)}getListCities(e,t,r){const a=this.options.useProxy?(0,g.default)(this.options.serviceUrl):this.options.serviceUrl;a&&this.getFeatureCall(a,{StoredQuery_ID:"SamtgemeindeZuKreis",kreis:e},s=>{const i=this.parseResponseGetFeature(s,"app:mrh_samtgemeinden","app:gemeinde",this.options.blacklistedDistricts);i.sort((n,o)=>n<o?-1:n>o?1:0),t(i)},r)}getFeaturesDistrict(e,t,r,a,s,i){const n=this.options.useProxy?(0,g.default)(this.options.serviceUrl):this.options.serviceUrl;n&&this.getFilterCall(n,{featureType:"app:mrh_pendler_kreise",propertyName:t?"app:wohnort":"app:arbeitsort",literal:e},o=>{const p=this.convertXmlToFeatureList(o,"mrh_pendler_kreise"),y=this.translateFeatureList(p,t?"arbeitsort":"wohnort","anzahl_einpendler",["wohnort","arbeitsort","anzahl_einpendler","richtung"],t),l=this.removeBlacklistedFeatures(y,this.options.blacklistedDistricts),f=this.getMinValue(l),m=this.getMaxValue(l);l.sort((v,_)=>_.get("value")-v.get("value")),s({caption:e,featureList:this.paginateFeatureList(l,r,a),coordinate:this.getCenterCoordinate(l,t),totalMin:f,totalMax:m,totalLength:l.length,start:r,len:a&&a<=l.length?a:l.length,source:"getFeaturesDistrict"})},i)}getFeaturesCity(e,t,r,a,s,i){const n=this.options.useProxy?(0,g.default)(this.options.serviceUrl):this.options.serviceUrl;n&&this.getFilterCall(n,{featureType:"app:mrh_einpendler_gemeinde",propertyName:t?"app:wohnort":"app:arbeitsort",literal:e},o=>{const p=this.convertXmlToFeatureList(o,"mrh_einpendler_gemeinde"),y=this.translateFeatureList(p,t?"arbeitsort":"wohnort","anzahl_einpendler",["wohnort","wohnort_kreis","arbeitsort","arbeitsort_kreis","anzahl_einpendler","anzahl_einpendler_maenner","anzahl_einpendler_frauen","anzahl_einpendler_deutsche","anzahl_einpendler_andere","anzahl_einpendler_auszubildende","richtung"],t),l=this.removeBlacklistedFeatures(y,this.options.blacklistedDistricts),f=this.getMinValue(l),m=this.getMaxValue(l);l.sort((v,_)=>_.get("value")-v.get("value")),s({caption:e,featureList:this.paginateFeatureList(l,r,a),coordinate:this.getCenterCoordinate(l,t),totalMin:f,totalMax:m,totalLength:l.length,start:r,len:a&&a<=l.length?a:l.length,source:"getFeaturesCity"})},i)}removeBlacklistedFeatures(e,t){const r={},a=[];return t.forEach(s=>{r[s]=!0}),e.forEach(s=>{Object.prototype.hasOwnProperty.call(r,s.get("caption"))||a.push(s)}),a}paginateFeatureList(e,t,r){return t===0&&r===0?e:t>0&&r===0?e.slice(t):e.slice(t,t+r)}getMinValue(e){let t=0;return e.forEach(r=>{(t===0||r.get("value")<t)&&(t=r.get("value"))}),t}getMaxValue(e){let t=0;return e.forEach(r=>{r.get("value")>t&&(t=r.get("value"))}),t}getCenterCoordinate(e,t){return!Array.isArray(e)||!e.length?!1:t?e[0].getGeometry().getFirstCoordinate():e[0].getGeometry().getLastCoordinate()}translateFeatureList(e,t,r,a,s){return e.forEach(i=>{i.set("caption",i.get(t),!0),i.set("value",parseInt(i.get(r),10),!0),s?i.set("coordinate",i.getGeometry().getLastCoordinate(),!0):i.set("coordinate",i.getGeometry().getFirstCoordinate(),!0),a.forEach(n=>{i.unset(n,!0)})}),e}convertXmlToFeatureList(e,t){return new T.WFS({featureNS:"http://www.deegree.org/app",featureType:t}).readFeatures(e)}parseResponseGetFeature(e,t,r,a=[]){if(!(e instanceof Document)&&e.constructor.name!=="XMLDocument")return{};const s=e.getElementsByTagName(t),i=[],n={};return s instanceof HTMLCollection?(a.forEach(o=>{n[o]=!0}),Object.keys(s).forEach(o=>{const p=s[o];!(p instanceof Element)||!(p.attributes instanceof NamedNodeMap)||!(p.getElementsByTagName(r)instanceof HTMLCollection)||!p.getElementsByTagName(r).length||!(p.getElementsByTagName(r)[0]instanceof Element)||Object.prototype.hasOwnProperty.call(n,p.getElementsByTagName(r)[0].textContent)||i.push(p.getElementsByTagName(r)[0].textContent)}),i):{}}getFeatureCall(e,t,r,a){const s=Object.assign({service:"WFS",request:"GetFeature",version:"2.0.0"},t),i=O.default.sha1(e+"_"+JSON.stringify(s));if(Object.prototype.hasOwnProperty.call(this.cache,i)){r(this.cache[i]);return}b.default.get(e,{params:s}).then(n=>{var o;this.cache[i]=(o=n?.request)==null?void 0:o.responseXML,r(this.cache[i])}).catch(n=>a(n))}getFilterCall(e,t,r,a){const s=Object.assign({featureType:"",propertyName:"",literal:"",service:"WFS",version:"1.1.0"},t),i=`<?xml version='1.0' encoding='UTF-8' ?>
<wfs:GetFeature service='${s.service}' version='${s.version}' xmlns:app='http://www.deegree.org/app' xmlns:wfs='http://www.opengis.net/wfs' xmlns:ogc='http://www.opengis.net/ogc'>
    <wfs:Query typeName='${s.featureType}'>
        <ogc:Filter>
            <ogc:PropertyIsEqualTo>
                <ogc:PropertyName>${s.propertyName}</ogc:PropertyName>
                <ogc:Literal>${s.literal}</ogc:Literal>
            </ogc:PropertyIsEqualTo>
        </ogc:Filter>
    </wfs:Query>
</wfs:GetFeature>`,n=O.default.sha1(e+"_"+JSON.stringify(s));if(Object.prototype.hasOwnProperty.call(this.cache,n)){r(this.cache[n]);return}b.default.post(e,i,{headers:{"Content-Type":"text/xml"}}).then(o=>{this.cache[n]=o?.data,r(o?.data)}).catch(o=>a(o))}}}}]);
