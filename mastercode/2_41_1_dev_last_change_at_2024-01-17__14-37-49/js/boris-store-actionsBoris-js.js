(window.webpackJsonp=window.webpackJsonp||[]).push([[13,230,231],{3887:function(x,N,v){var _=Object.defineProperty,m=Object.getOwnPropertyDescriptor,B=Object.getOwnPropertyNames,I=Object.prototype.hasOwnProperty,T=(g,y)=>{for(var S in y)_(g,S,{get:y[S],enumerable:!0})},D=(g,y,S,n)=>{if(y&&typeof y=="object"||typeof y=="function")for(let e of B(y))!I.call(g,e)&&e!==S&&_(g,e,{get:()=>y[e],enumerable:!(n=m(y,e))||n.enumerable});return g},G=g=>D(_({},"__esModule",{value:!0}),g),L={};T(L,{getLayerModelByAttributes:()=>M,getLayerModelsByAttributes:()=>F}),x.exports=G(L);var b=v(13);function F(g){return b.Radio.request("ModelList","getModelsByAttributes",g)}function M({id:g}){return b.Radio.request("ModelList","getModelByAttributes",{id:g})}},3903:function(x,N,v){(function(_){var m=Object.create,B=Object.defineProperty,I=Object.getOwnPropertyDescriptor,T=Object.getOwnPropertyNames,D=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty,L=(o,r)=>{for(var t in r)B(o,t,{get:r[t],enumerable:!0})},b=(o,r,t,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let l of T(r))!G.call(o,l)&&l!==t&&B(o,l,{get:()=>r[l],enumerable:!(a=I(r,l))||a.enumerable});return o},F=(o,r,t)=>(t=o!=null?m(D(o)):{},b(r||!o||!o.__esModule?B(t,"default",{value:o,enumerable:!0}):t,o)),M=o=>b(B({},"__esModule",{value:!0}),o),g=(o,r,t)=>new Promise((a,l)=>{var u=d=>{try{p(t.next(d))}catch(w){l(w)}},c=d=>{try{p(t.throw(d))}catch(w){l(w)}},p=d=>d.done?a(d.value):Promise.resolve(d.value).then(u,c);p((t=t.apply(o,r)).next())}),y={};L(y,{default:()=>O}),x.exports=M(y);var S=F(v(25)),n=F(v(3904)),e=F(v(284)),s=v(58),i=v(3887),h=F(v(4217)),f=F(v(2117)),O={initialize({commit:o}){let r=(0,i.getLayerModelsByAttributes)({isNeverVisibleInTree:!0});r&&(r.forEach(t=>t.set("parentId","noParent")),r=r.filter(function(t){return t.get("gfiAttributes")!=="ignore"}),r=r.reverse(),o("setFilteredLayerList",r))},handleUrlParameters({rootState:o,dispatch:r,commit:t}){var a,l;const u=(a=o.urlParams)==null?void 0:a.brwId,c=(l=o.urlParams)==null?void 0:l.brwLayerName,p=o.urlParams&&o.urlParams["Maps/center"],d=!0;u&&c&&p&&(t("setIsProcessFromParametricUrl",d),t("setParamUrlParams",{brwId:u,brwLayerName:c,center:p}),r("switchLayer",c),t("setSelectedLayerName",c),r("Maps/setCenter",p,{root:!0}),r("requestGFI",{processFromParametricUrl:d,center:p}))},simulateLanduseSelect({commit:o,getters:r}){const t=r.findLanduseByBrwId;o("setSelectedLanduse",t),o("setIsProcessFromParametricUrl",!1)},switchLayer({rootGetters:o,state:r,dispatch:t,commit:a},l){var u,c;const p=r.filteredLayerList.filter(function(P){return P.get("isSelected")===!0}),d=l.split(".")[2];let w=null;p.forEach(P=>{P.set("isVisibleInMap",!1),P.set("isSelected",!1),w=P.get("name").split(".")[2]}),t("selectLayerByName",l),a("setSelectedLayerName",l),d>2008?o["Maps/clickCoordinate"]&&t("requestGFI",{processFromParametricUrl:!1,center:null}):(t("MapMarker/removePolygonMarker",null,{root:!0}),o["Maps/clickCoordinate"]&&!(w>2008&&d<=2008)&&t("requestGFI",{processFromParametricUrl:!1,center:null})),w>2008&&d<=2008?t("requestGFI",{processFromParametricUrl:!1,center:null}):d>2008&&w<=2008&&(t("MapMarker/removePointMarker",null,{root:!0}),a("setSelectedBrwFeature",{}),a("setTextIds",[])),((u=r.selectedLayer)==null?void 0:u.get("typ"))!=="GROUP"&&((c=r.selectedLayer)==null?void 0:c.attributes.layers.indexOf("flaeche"))>-1?(a("setIsAreaLayer",!0),t("toggleStripesLayer",r.isStripesLayer)):(a("setIsAreaLayer",!1),t("toggleStripesLayer",!1))},toggleStripesLayer({state:o,dispatch:r,commit:t},a){const l=o.filteredLayerList.filter(d=>d.get("isNeverVisibleInTree")===!0),u=l.find(d=>d.get("isSelected")===!0),c=u.attributes.name,p=c+"-stripes";if(t("setIsStripesLayer",a),a)r("selectLayerByName",p);else{const d=l.find(w=>w.get("name")===p);d&&(d.set("isVisibleInMap",!1),d.set("isSelected",!1))}},selectLayerByName({state:o,commit:r},t){const a=o.filteredLayerList.filter(u=>u.get("isNeverVisibleInTree")===!0),l=a.find(u=>{if(u.get("name")===t)return u});l!==void 0&&(l.set("isVisibleInMap",!0),l.set("isSelected",!0),r("setSelectedLayer",l))},requestGFI({rootGetters:o,state:r,dispatch:t},{processFromParametricUrl:a,center:l}){if(r.active){const u=r.filteredLayerList.find(z=>z.get("isSelected")===!0),c=a?l:o["Maps/clickCoordinate"],p=f.default.getMap("2D"),d=p.getView();let w,P=null;if(u.get("typ")==="GROUP"){const z=u.get("layerSource");w=z[z.length-1].get("layer").getSource()}else w=u.get("layer").getSource();P=w.getFeatureInfoUrl(c,d.getResolution(),d.getProjection()),S.default.get(P).then(z=>{z.status===200&&t("handleGfiResponse",{response:z.data,coordinate:c})}).catch(z=>{console.error(z.response),t("Alerting/addSingleAlert",_.t("additional:modules.tools.boris.alertMessage:noData"),{root:!0})})}},handleGfiResponse({state:o,dispatch:r,commit:t},{response:a,coordinate:l}){const u=new s.WMSGetFeatureInfo().readFeature(a);u!==null?parseInt(u.get("jahrgang"),10)>2008?(u.set("nutzungsart",JSON.parse(u.get("nutzungsart")).nutzungen),r("getFeatureRequestById",{featureId:u.getId(),featureYear:u.get("jahrgang")}),t("setSelectedPolygon",u),r("matchPolygonFeatureWithLanduse",{feature:u,selectedLanduse:o.selectedLanduse})):(t("setBrwFeatures",u),r("MapMarker/placingPointMarker",l,{root:!0}),r("Maps/setCenter",l,{root:!0}),r("combineFeatureWithSelectedDate",u),t("setSelectedPolygon",null)):(r("Alerting/addSingleAlert",_.t("additional:modules.tools.boris.alertMessage:noBrw"),{root:!0}),r("MapMarker/removePolygonMarker",null,{root:!0}),r("MapMarker/removePointMarker",null,{root:!0}),t("setSelectedBrwFeature",{}),t("setSelectedPolygon",null),t("setSelectedLanduse",""),t("setTextIds",[]),t("Maps/setClickCoordinate",null,{root:!0}))},getFeatureRequestById({dispatch:o},{featureId:r,featureYear:t}){const a=parseInt(t,10),l=Config.layerConf.lastIndexOf("/"),u=Config.layerConf.substring(0,l);let c,p=null,d="geom_zone";r.indexOf("FLAECHE")>-1?(c="app:v_brw_zonen_geom_flaeche_"+t,d="geom_zone_flaeche"):a<=2008?c="lgv_brw_lagetypisch_alle":a<=2014?c="lgv_brw_zoniert_"+t:c="lgv_brw_zonen_"+t,p="typeName"+c+"&featureID="+r,S.default.get(u+"/HH_WFS_Bodenrichtwerte?service=WFS&version=1.1.0&request=GetFeature&"+p).then(w=>{const P=new s.WFS().readFeature(w.data);P&&(P.unset("geom_brw_grdstk"),P.setGeometryName(d),o("MapMarker/placingPolygonMarker",P,{root:!0}))}).catch(w=>{console.error(w.message),o("Alerting/addSingleAlert",_.t("additional:modules.tools.boris.alertMessage:noData"),{root:!0})})},matchPolygonFeatureWithLanduse({dispatch:o,commit:r},{feature:t,selectedLanduse:a}){const l=t.get("nutzungsart").find(u=>u.nutzungsart===a);l?o("postFeatureRequestByBrwNumber",{brwNumber:l.richtwertnummer,featureYear:t.get("jahrgang")}):(r("setSelectedLanduse",""),r("setSelectedBrwFeature",{}))},postFeatureRequestByBrwNumber({dispatch:o},{brwNumber:r,featureYear:t}){const a=parseInt(t,10)>2008?"lgv_brw_zoniert_alle":"lgv_brw_lagetypisch_alle",l=Config.layerConf.lastIndexOf("/"),u=Config.layerConf.substring(0,l),c=`<GetFeature version='1.1.0' xmlns:wfs='http://www.opengis.net/wfs'>
            <wfs:Query typeName='${a}'>
                <Filter xmlns='http://www.opengis.net/ogc'>
                    <PropertyIsEqualTo>
                        <PropertyName>richtwertnummer</PropertyName>
                        <Literal>${r}</Literal>
                    </PropertyIsEqualTo>
                </Filter>
            </wfs:Query>
        </GetFeature>`;(0,S.default)({method:"post",url:u+"/HH_WFS_Bodenrichtwerte",data:c,headers:{"Content-Type":"text/xml"}}).then(p=>{p.status===200&&o("handleGetFeatureResponse",{response:p.data,status:p.status,year:t})}).catch(p=>{console.error(p.response),o("Alerting/addSingleAlert",_.t("additional:modules.tools.boris.alertMessage:noData"),{root:!0})})},handleGetFeatureResponse(o,r){return g(this,arguments,function*({dispatch:t,commit:a},{response:l,year:u}){const c=new s.WFS().readFeatures(l),p=yield n.default.findBrwFeatureByYear({features:c,year:u});a("setBrwFeatures",c),t("combineFeatureWithSelectedDate",p)})},combineFeatureWithSelectedDate(o,r){return g(this,arguments,function*({dispatch:t,getters:a},l){const u=yield a.getDateBySelectedLayerName;l!==void 0?t("extendFeatureAttributes",{feature:l,date:u}):(console.error("Data query failed"),t("Alerting/addSingleAlert",_.t("additional:modules.tools.boris.alertMessage:noData"),{root:!0}))})},getDateByActiveLayerName({state:o}){let r="";const t=o.filteredLayerList.find(a=>a?.get("isSelected")===!0);return t&&(r=t.get("name")),r},extendFeatureAttributes({dispatch:o,commit:r,state:t},{feature:a,date:l}){const u=parseInt(a.get("jahrgang"),10)<2002,c=n.default.parseSW({feature:a});return a.setProperties({richtwert_dm:u?(0,e.default)(parseFloat(a.get("richtwert_dm"),10).toFixed(1)):"",richtwert_euro:(0,e.default)(a.get("richtwert_euro")),schichtwert:c,stichtag:l,convertedBrw:"",convertedBrwDM:"",zEntwicklungszustand:a.get("entwicklungszustand"),zBeitragszustand:a.get("beitragszustand"),zNutzung:a.get("nutzung_kombiniert"),zBauweise:t.selectedBuildDesign!==""?t.selectedBuildDesign:null,zGeschossfl_zahl:a.get("geschossfl_zahl")!==""?a.get("geschossfl_zahl"):null,zGrdstk_flaeche:a.get("grdstk_flaeche")!==""?a.get("grdstk_flaeche"):null,zStrassenLage:a.get("nutzung_kombiniert")==="EFH Ein- und Zweifamilienh\xE4user"?t.selectedPositionToStreet:null}),r("setSelectedBrwFeature",a),o("sendWpsConvertRequest",t),a},sendWpsConvertRequest({dispatch:o,state:r}){const t=n.default.convert({brw:r.selectedBrwFeature});h.default.wpsRequest(r.wpsId,r.fmwProcess,t,(a,l)=>o("handleConvertResponse",{response:a,status:l}))},handleConvertResponse({dispatch:o},{response:r,status:t}){let a,l,u=!1;t===200?(l=r.ExecuteResponse,l.ProcessOutputs?(a=r.ExecuteResponse.ProcessOutputs.Output.Data.ComplexData,a.serviceResponse?(u=!0,console.error("FME-Server status info: "+a.serviceResponse.statusInfo.message)):a.Bodenrichtwert&&(a.Bodenrichtwert.Ergebnis.ErrorOccured!=="No"?(u=!0,console.error("BRWConvert error message: "+a.Bodenrichtwert.Ergebnis.Fehlermeldung)):o("updateSelectedBrwFeature",{converted:"convertedBrw",brw:a.Bodenrichtwert.Ergebnis.BRW}))):l.Status&&(u=!0,console.error("FME-Server execute response: "+l.Status.ProcessFailed.ExceptionReport.Exception.ExceptionText))):(u=!0,console.error("WPS-Query with status "+t+" aborted.")),u&&o("Alerting/addSingleAlert",_.t("additional:modules.tools.boris.alertMessage:noData"),{root:!0})},updateSelectedBrwFeature({state:o,commit:r},{converted:t,brw:a}){if(Object.keys(o.selectedBrwFeature).length!==0){const l=o.selectedBrwFeature,u=parseInt(l.get("jahrgang"),10)<2002,c=u?(0,e.default)((parseFloat(a,10)*1.95583).toFixed(1)):"";switch(t){case"zBauweise":l.setProperties({zBauweise:a,convertedBrw:"",convertedBrwDM:""});break;case"zGeschossfl_zahl":l.setProperties({zGeschossfl_zahl:a,convertedBrw:"",convertedBrwDM:""});break;case"zGrdstk_flaeche":l.setProperties({zGrdstk_flaeche:a,convertedBrw:"",convertedBrwDM:""});break;case"zStrassenLage":l.setProperties({zStrassenLage:a,convertedBrw:"",convertedBrwDM:""});break;default:l.setProperties({convertedBrw:(0,e.default)(a)}),l.setProperties({convertedBrwDM:c})}r("setSelectedBrwFeature",l),r("setConvertedBrw",o.selectedBrwFeature.get("convertedBrw"))}}}}).call(this,v(6))},3904:function(x,N,v){var _=Object.create,m=Object.defineProperty,B=Object.getOwnPropertyDescriptor,I=Object.getOwnPropertyNames,T=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,G=(n,e)=>{for(var s in e)m(n,s,{get:e[s],enumerable:!0})},L=(n,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let h of I(e))!D.call(n,h)&&h!==s&&m(n,h,{get:()=>e[h],enumerable:!(i=B(e,h))||i.enumerable});return n},b=(n,e,s)=>(s=n!=null?_(T(n)):{},L(e||!n||!n.__esModule?m(s,"default",{value:n,enumerable:!0}):s,n)),F=n=>L(m({},"__esModule",{value:!0}),n),M={};G(M,{default:()=>S}),x.exports=F(M);var g=b(v(284));const y={findBrwFeatureByYear:function({features:n,year:e}){return n?Object.values(n).find(i=>i.get("jahrgang")===e):null},convert:function({brw:n}){const e={};let s=n.get("richtwert_euro").replace(".","").replace(",",".");if(s.match(/,/)&&s.match(/\./)&&(s=s.replace(".","").replace(",",".")),e.BRW={dataType:"float",value:s},e.STAG={dataType:"string",value:n.get("stichtag")},e.ENTW={dataType:"string",value:n.get("entwicklungszustand")},e.ZENTW={dataType:"string",value:n.get("zEntwicklungszustand")},e.BEIT={dataType:"string",value:n.get("beitragszustand")},e.ZBEIT={dataType:"string",value:n.get("zBeitragszustand")},e.NUTA={dataType:"string",value:n.get("nutzung_kombiniert")},e.ZNUTA={dataType:"string",value:n.get("zNutzung")},n.get("bauweise")&&(e.BAUW={dataType:"string",value:n.get("bauweise")}),n.get("grdstk_flaeche")&&(e.FLAE={dataType:"float",value:n.get("grdstk_flaeche")}),n.get("geschossfl_zahl")&&(e.WGFZ={dataType:"float",value:n.get("geschossfl_zahl")}),n.get("schichtwert")&&(n.get("schichtwert").normschichtwert_wohnen&&(e.NWohnW={dataType:"float",value:n.get("schichtwert").normschichtwert_wohnen.replace(".","").replace(",",".")}),n.get("schichtwert").normschichtwert_buero&&(e.NBueroW={dataType:"float",value:n.get("schichtwert").normschichtwert_buero.replace(".","").replace(",",".")}),n.get("schichtwert").normschichtwert_laden&&(e.NLadenW={dataType:"float",value:n.get("schichtwert").normschichtwert_laden.replace(".","").replace(",",".")}),n.get("schichtwert").schichtwerte))for(const i of n.get("schichtwert").schichtwerte)i.geschoss==="3. Obergeschoss oder h\xF6her"&&(e.OGNutzung={dataType:"string",value:i.nutzung},e.OGGFZAnt={dataType:"float",value:i.wgfz},e.OGW={dataType:"float",value:i.schichtwert.replace(".","").replace(",",".")}),i.geschoss==="2. Obergeschoss"&&(e.ZGNutzung={dataType:"string",value:i.nutzung},e.ZGGFZAnt={dataType:"float",value:i.wgfz},e.ZGW={dataType:"float",value:i.schichtwert.replace(".","").replace(",",".")}),i.geschoss==="1. Obergeschoss"&&(e.IGNutzung={dataType:"string",value:i.nutzung},e.IGGFZAnt={dataType:"float",value:i.wgfz},e.IGW={dataType:"float",value:i.schichtwert.replace(".","").replace(",",".")}),i.geschoss==="Erdgeschoss"&&(e.EGNutzung={dataType:"string",value:i.nutzung},e.EGGFZAnt={dataType:"float",value:i.wgfz},e.EGW={dataType:"float",value:i.schichtwert.replace(".","").replace(",",".")}),i.geschoss==="Untergeschoss"&&(e.UGNutzung={dataType:"string",value:i.nutzung},e.UGGFZAnt={dataType:"float",value:i.wgfz},e.UGW={dataType:"float",value:i.schichtwert.replace(".","").replace(",",".")});return n.get("zBauweise")&&(e.ZBAUW={dataType:"string",value:n.get("zBauweise")}),n.get("zGeschossfl_zahl")&&(e.ZWGFZ={dataType:"float",value:n.get("zGeschossfl_zahl")}),n.get("zGrdstk_flaeche")&&(e.ZFLAE={dataType:"float",value:n.get("zGrdstk_flaeche")}),n.get("zStrassenLage")&&(e.ZStrLage={dataType:"string",value:n.get("zStrassenLage")}),e},getSW:function(n){return n.get("schichtwert")?n.get("schichtwert"):null},parseSW:function({feature:n}){const e=parseInt(n.get("jahrgang"),10)<2002;let s=y.getSW(n);return s&&(typeof s=="string"&&(s=JSON.parse(s)),s.normschichtwert_wohnen&&(s.normschichtwert_wohnenDM=e?(0,g.default)((parseFloat(s.normschichtwert_wohnen,10)*1.95583).toFixed(1)):"",s.normschichtwert_wohnen=(0,g.default)(s.normschichtwert_wohnen)),s.normschichtwert_buero&&(s.normschichtwert_bueroDM=e?(0,g.default)((parseFloat(s.normschichtwert_buero,10)*1.95583).toFixed(1)):"",s.normschichtwert_buero=(0,g.default)(s.normschichtwert_buero)),s.normschichtwert_laden&&(s.normschichtwert_ladenDM=e?(0,g.default)((parseFloat(s.normschichtwert_laden,10)*1.95583).toFixed(1)):"",s.normschichtwert_laden=(0,g.default)(s.normschichtwert_laden)),s.schichtwerte&&s.schichtwerte.forEach(function(i){i.schichtwertDM=e?(0,g.default)((parseFloat(i.schichtwert,10)*1.95583).toFixed(1)):"",i.schichtwert=(0,g.default)(i.schichtwert)})),s}};var S=y},4217:function(x,N,v){var _=Object.create,m=Object.defineProperty,B=Object.getOwnPropertyDescriptor,I=Object.getOwnPropertyNames,T=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,G=(e,s)=>{for(var i in s)m(e,i,{get:s[i],enumerable:!0})},L=(e,s,i,h)=>{if(s&&typeof s=="object"||typeof s=="function")for(let f of I(s))!D.call(e,f)&&f!==i&&m(e,f,{get:()=>s[f],enumerable:!(h=B(s,f))||h.enumerable});return e},b=(e,s,i)=>(i=e!=null?_(T(e)):{},L(s||!e||!e.__esModule?m(i,"default",{value:e,enumerable:!0}):i,e)),F=e=>L(m({},"__esModule",{value:!0}),e),M={};G(M,{default:()=>n}),x.exports=F(M);var g=b(v(25)),y=b(v(1203)),S=b(v(7)),n={sendRequest:function(e,s,i,h){(0,g.default)({method:"post",url:e,data:s,headers:{"Content-Type":"text/xml"},timeout:h}).then(f=>this.handleResponse(f,i))},handleResponse:function(e,s){let i;e.status===200&&(i=this.parseDataString(e.data)),s(i,e.status)},parseDataString:function(e){const s=new DOMParser().parseFromString(e,"text/xml");return(0,y.default)(s,!1)},buildXML:function(e,s,i,h={}){let f=this.setXMLElement(s,"</ows:Identifier>",e);return Object.entries(h).forEach(E=>{const O=E[1],o=E[0],r=Object.prototype.hasOwnProperty.call(O,"dataType")?O.dataType:void 0,t=Object.prototype.hasOwnProperty.call(O,"value")?O.value:O;let a;a=this.setXMLElement(i,"</ows:Identifier>",o),a=this.setXMLElement(a,"</wps:LiteralData>",t,r),f=this.setXMLElement(f,"</wps:DataInputs>",a)}),f},setXMLElement:function(e,s,i,h){let f=e===void 0?"":e;return h!==void 0&&(f=f.toString().replace("<wps:LiteralData>","<wps:LiteralData dataType='"+h+"'>")),e!==void 0&&s!==void 0&&i!==void 0&&(f=f.toString().replace(s.toString(),i.toString()+s.toString())),f},wpsRequest:function(e,s,i,h,f){var E;const O='<wps:Execute xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ows="http://www.opengis.net/ows/1.1" service="WPS" version="1.0.0" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsExecute_request.xsd"><ows:Identifier></ows:Identifier><wps:DataInputs></wps:DataInputs></wps:Execute>',o="<wps:Input><ows:Identifier></ows:Identifier><wps:Data><wps:LiteralData></wps:LiteralData></wps:Data></wps:Input>",r=this.buildXML(s,O,o,i),t=(E=S.default.getters.getRestServiceById(e))==null?void 0:E.url;this.sendRequest(t,r,h,f)}}}}]);
