(window.webpackJsonp=window.webpackJsonp||[]).push([[496],{3842:function(S,B,u){(function(m,l){var N=Object.create,p=Object.defineProperty,M=Object.getOwnPropertyDescriptor,O=Object.getOwnPropertyNames,T=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty,_=(e,t)=>{for(var r in t)p(e,r,{get:t[r],enumerable:!0})},w=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of O(t))!P.call(e,a)&&a!==r&&p(e,a,{get:()=>t[a],enumerable:!(o=M(t,a))||o.enumerable});return e},y=(e,t,r)=>(r=e!=null?N(T(e)):{},w(t||!e||!e.__esModule?p(r,"default",{value:e,enumerable:!0}):r,e)),L=e=>w(p({},"__esModule",{value:!0}),e),v=(e,t,r)=>new Promise((o,a)=>{var n=s=>{try{i(r.next(s))}catch(c){a(c)}},d=s=>{try{i(r.throw(s))}catch(c){a(c)}},i=s=>s.done?o(s.value):Promise.resolve(s.value).then(n,d);i((r=r.apply(e,t)).next())}),b={};_(b,{default:()=>D}),S.exports=L(b);var g=y(u(90)),F=u(58),C=y(u(4568)),R=u(4269),A=y(u(25)),D={addModelsByAttributesToModelList:function(e,t){m.request("ModelList","getModelsByAttributes",{id:t}).length===0&&m.trigger("ModelList","addModelsByAttributes",{id:t})},setModelAttributesByIdToModelList:function(e,t){m.trigger("ModelList","setModelAttributesById",t.layerId,{isSelected:t.isActive,isVisibleInMap:t.isActive})},toggleRasterLayer:function({getters:e,dispatch:t}){const r=e.wmsRasterLayerId,o=e.active;t("addModelsByAttributesToModelList",r),t("setModelAttributesByIdToModelList",{layerId:r,isActive:o})},loadWfsRaster:function({getters:e,dispatch:t}){const r=e.wfsRasterParams,o={Service:r.service,Version:r.version,Request:r.request,TypeName:r.typename};let a={};A.default.get(r.url,{params:o,headers:{"Content-Type":"text/xml"},responseType:"document"}).then(n=>{t("readFeatures",n.data)}).catch(n=>{a={category:l.t(e.error),content:l.t(e.downloadError),displayClass:"error"},t("Alerting/addSingleAlert",a,{root:!0}),console.error(n.response)})},readFeatures:function({commit:e},t){const r=new F.WFS,o=r.readFeatures(t);e("setWfsRaster",o)},calculateSelectedRasterNames:function(e){return v(this,arguments,function*({getters:t,dispatch:r,commit:o,rootState:a}){const n=t.wfsRaster,d=a.GraphicalSelect.selectedAreaGeoJson,i=[];if(d&&d.coordinates){const s=(0,R.polygon)([d.coordinates[0]]);n.forEach(c=>v(this,null,function*(){const h=yield r("GraphicalSelect/featureToGeoJson",c,{root:!0}),f=(0,R.polygon)([h.coordinates[0]]);(0,C.default)(s,f)&&(yield r("addFeaturenameToRasternames",{feature:c,rasterNames:i}))}))}o("setRasterNames",i)})},addFeaturenameToRasternames:function(e,t){if(t.feature&&t.rasterNames){const r=t.feature.getProperties().kachel;t.rasterNames.find(a=>a===r)===void 0&&t.rasterNames.push(r)}},requestCompressedData:function(e){return v(this,arguments,function*({getters:t,dispatch:r}){const o={};r("calculateSelectedRasterNames").then(()=>r("checkRasterNamesAmount").then(a=>{if(a===!0){const n=[];t.rasterNames.forEach(i=>{const s=i.substring(0,2)+"0"+i.substring(2,4)+"0";n.push(s)}),o.query="kacheln="+n.join("\xA7")+"&type="+t.selectedFormat,o.downloadName="zip_"+t.selectedFormat+"_"+n.sort()[0]+".zip",r("doRequest",o)}}))})},checkRasterNamesAmount:function({getters:e,dispatch:t}){const r=e.rasterNames;let o={},a={};return r.length>e.selectedRasterLimit?(o={category:l.t(e.info),content:l.t(e.tooManyTilesSelected,{tilesCount:r.length,maxTiles:e.selectedRasterLimit}),displayClass:"info"},t("Alerting/addSingleAlert",o,{root:!0}),g.default.hide(),!1):r.length===0?(a={category:l.t(e.info),content:"<strong>"+e.pleaseSelectTiles+"</strong>",displayClass:"info"},t("Alerting/addSingleAlert",a,{root:!0}),!1):!0},requestCompressIslandData:function({getters:e,dispatch:t},r){const o={downloadName:"zip_"+e.selectedFormat+"_"+r+".zip",query:"insel="+r+"&type="+e.selectedFormat};t("doRequest",o)},requestCompressRasterOverviewData:function({dispatch:e},t){const r={downloadName:"U__Kachel_Uebersichten_UTM_Kachel_1KM_"+t+".dwg",query:"system=utm&type="+t};e("doRequest",r)},doRequest:function({getters:e,dispatch:t,commit:r},o){const a=m.request("RestReader","getServiceById",e.compressDataId).get("url"),n=A.default.create();let d={},i={};n.interceptors.request.use(function(s){return g.default.show(15e3),s}),n.interceptors.response.use(function(s){return g.default.hide(),s}),n.post(a,o.query,{timeout:15e3,responseType:"blob"}).then(s=>{if(r("setGraphicalSelectStatus",!0),s.status!==200)d={category:l.t(e.error),content:"<strong>"+l.t(e.failedToDownload)+"</strong> <br> <small>"+l.t(e.details)+" "+s.data+"</small>",displayClass:"error"},t("Alerting/addSingleAlert",d,{root:!0});else{const c=new Blob([s.data]),h=window.URL.createObjectURL(c),f=document.createElement("a");window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(c,o.downloadName):(f.href=h,f.setAttribute("download",o.downloadName),document.body.appendChild(f),f.click(),f.remove())}}).catch(()=>{i={category:l.t(e.error),content:"<strong>"+l.t(e.failedToDownload)+"</strong> <br> <small>"+l.t(e.details)+" "+l.t(e.serviceNotResponding)+"</small>",displayClass:"error"},r("setGraphicalSelectStatus",!1),t("Alerting/addSingleAlert",i,{root:!0})})}}}).call(this,u(3),u(6))}}]);
