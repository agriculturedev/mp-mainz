(window.webpackJsonp=window.webpackJsonp||[]).push([[453,459,460],{3828:function(R,j,g){(function(v){var x=Object.create,I=Object.defineProperty,m=Object.getOwnPropertyDescriptor,A=Object.getOwnPropertyNames,w=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty,N=(s,l)=>{for(var u in l)I(s,u,{get:l[u],enumerable:!0})},C=(s,l,u,M)=>{if(l&&typeof l=="object"||typeof l=="function")for(let _ of A(l))!z.call(s,_)&&_!==u&&I(s,_,{get:()=>l[_],enumerable:!(M=m(l,_))||M.enumerable});return s},b=(s,l,u)=>(u=s!=null?x(w(s)):{},C(l||!s||!s.__esModule?I(u,"default",{value:s,enumerable:!0}):u,s)),O=s=>C(I({},"__esModule",{value:!0}),s),T={};N(T,{default:()=>L}),R.exports=O(T);var o=b(g(1208)),f=b(g(167)),p=b(g(7));function L(s=!1){const l=v.request("Map","getLayers"),u=typeof l?.getArray!="function"?[]:l.getArray().filter(M=>M.getVisible()===!0&&(M.get("name")!=="markerPoint"||s));Array.isArray(u)&&u.length&&y(u)}function y(s){const l=s.filter(M=>typeof M.getZIndex()<"u"),u=(0,o.default)(s,l);u.push((0,f.default)(l,M=>M.getZIndex())),p.default.dispatch("Tools/HochWasserPrint/setVisibleLayerList",[].concat(...u))}}).call(this,g(3))},3829:function(R,j,g){(function(v,x){var I=Object.create,m=Object.defineProperty,A=Object.getOwnPropertyDescriptor,w=Object.getOwnPropertyNames,z=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty,C=(t,e)=>{for(var r in e)m(t,r,{get:e[r],enumerable:!0})},b=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of w(e))!N.call(t,n)&&n!==r&&m(t,n,{get:()=>e[n],enumerable:!(i=A(e,n))||i.enumerable});return t},O=(t,e,r)=>(r=t!=null?I(z(t)):{},b(e||!t||!t.__esModule?m(r,"default",{value:t,enumerable:!0}):r,t)),T=t=>b(m({},"__esModule",{value:!0}),t),o={};C(o,{default:()=>_,getLastPrintedExtent:()=>M}),R.exports=T(o);var f=g(107),p=O(g(284)),L=O(g(3874)),y=O(g(3828)),s=g(5),l=g(46);let u;function M(){return u}var _={retrieveCapabilites:function({state:t,dispatch:e,rootGetters:r,commit:i}){let n;t.serviceId!==""&&(n=r.getRestServiceById(t.serviceId).url,n.includes("/print/")||(n=n+"print/"),i("setServiceUrl",n),n=n+t.printAppId+"/"+t.printAppCapabilities,e("sendRequest",{serviceUrl:n,requestType:"GET",onSuccess:"parseCapabilities"}))},parseCapabilities:function({state:t,dispatch:e},r){t.printService==="mapfish"?e("parseMapfishCapabilities",r):e("parsePlotserviceCapabilities",r)},parseMapfishCapabilities:function({state:t,commit:e,dispatch:r},i){e("setLayoutList",i.layouts),r("chooseCurrentLayout",i.layouts),r("getAttributeInLayoutByName","scale"),e("setFormatList",t.formatList),e("setCurrentScale",v.request("MapView","getOptions").scale),r("togglePostrenderListener")},parsePlotserviceCapabilities:function({commit:t,dispatch:e},r){t("setLayoutList",r.layouts),e("chooseCurrentLayout",r.layouts),t("setScaleList",r.scales.map(i=>parseInt(i.value,10)).sort((i,n)=>i-n)),t("setFormatList",r.outputFormats.map(i=>i.name)),t("setCurrentScale",v.request("MapView","getOptions").scale),e("togglePostrenderListener")},chooseCurrentLayout:function({state:t,commit:e},r){const i=r.find(a=>a.name===t.currentLayoutName),n=i||r[0];e("setCurrentLayout",n),e("setCurrentLayoutName",n.name)},getAttributeInLayoutByName:function({state:t,commit:e},r){var i;Array.isArray((i=t.currentLayout)==null?void 0:i.attributes)&&t.currentLayout.attributes.forEach(n=>{if(n.name===r){const a=r.charAt(0).toUpperCase()+r.slice(1);e("setIs"+a+"Available",!0),e("set"+a+"Attribute",n)}})},togglePostrenderListener:function({state:t,dispatch:e,commit:r}){const i=[];if((0,y.default)(t.printMapMarker),i.length&&t.active&&e("Alerting/addSingleAlert",x.t("additional:modules.tools.hochWasserPrint.vtlWarning"),{root:!0}),r("setVisibleLayer",t.visibleLayerList),t.active&&t.layoutList.length!==0&&t.visibleLayerList.length>=1&&typeof t.eventListener>"u"&&t.maskStarted){const n=L.default.getCanvasLayer(t.visibleLayerList);r("setEventListener",n.on("postrender",a=>e("createPrintMask",a)))}else(!t.active||!t.maskStarted)&&(v.trigger("Map","unregisterListener",t.eventListener),r("setEventListener",void 0),t.invisibleLayer&&(e("setOriginalPrintLayer"),r("setHintInfo","")));e("getPrintMapScales"),mapCollection.getMap("2D").render()},setOriginalPrintLayer:function({state:t}){const e=t.invisibleLayer,r=t.currentMapScale,i=v.request("MapView","getResosolutionByScale",r,"max"),n=v.request("MapView","getResolutionByScale",r,"min");e.forEach(a=>{const c=v.request("ModelList","getModelByAttributes",{id:a.get("id")});i<=a.getMaxResolution()&&n>a.getMinResolution()?c.setIsOutOfRange(!1):c.setIsOutOfRange(!0),a.setVisible(!0)})},setPrintLayers:function({state:t,dispatch:e,commit:r},i){const n=t.visibleLayerList,a=v.request("MapView","getResolutionByScale",i,"max"),c=v.request("MapView","getResolutionByScale",i,"min"),d=[];let P="",S="";n.forEach(h=>{const E=v.request("ModelList","getModelByAttributes",{id:h.id});a>h.getMaxResolution()||c<h.getMinResolution()?(d.push(h),P+="- "+h.get("name")+"<br>",typeof E<"u"&&E.setIsOutOfRange(!0)):typeof E<"u"&&E.setIsOutOfRange(!1)}),S=x.t("additional:modules.tools.hochWasserPrint.invisibleLayer",{scale:"1: "+(0,p.default)(i," ")}),S=S+"<br>"+P,d.length&&S!==t.hintInfo&&(e("Alerting/addSingleAlert",S),r("setHintInfo",S)),d.length||r("setHintInfo",""),r("setInvisibleLayer",d)},updateCanvasLayer:function({state:t,commit:e,dispatch:r}){const i=t.visibleLayerList;let n={};v.trigger("Map","unregisterListener",t.eventListener),n=L.default.getCanvasLayer(i),r("chooseCurrentLayout",t.layoutList),Object.keys(n).length&&e("setEventListener",n.on("postrender",a=>{r("createPrintMask",a)}))},createPrintMask:function({dispatch:t,state:e},r){if(!e.maskStarted)return;t("getPrintMapSize");const i=r.frameState,n=r.context,a={frameState:r.frameState,context:r.context},c={pixelToCoordinateTransform:i.pixelToCoordinateTransform,mapSize:i.size,resolution:i.viewState.resolution,printMapSize:e.layoutMapInfo,scale:"",context:n},d={mapSize:i.size,resolution:i.viewState.resolution,printMapSize:e.layoutMapInfo,scaleList:e.scaleList};e.isScaleSelectedManually&&(c.scale=e.currentScale),e.autoAdjustScale?(t("getOptimalScale",d),c.scale=e.optimalScale):c.scale=e.currentScale,t("drawMask",a),t("drawPrintPage",c),n.fillStyle="rgba(0, 5, 25, 0.55)",n.fill(),t("setPrintLayers",c.scale)},getOptimalScale:function({commit:t,state:e},r){const i=r.mapSize[0]*r.resolution,n=r.mapSize[1]*r.resolution,a=i*e.INCHES_PER_METER*e.DOTS_PER_INCH/r.printMapSize[0],c=n*e.INCHES_PER_METER*e.DOTS_PER_INCH/r.printMapSize[1],d=Math.min(a,c);let P=r.scaleList[0];r.scaleList.forEach(S=>{d>S&&(P=S)}),t("setOptimalScale",P),t("setCurrentScale",P)},drawMask:function(t,e){const r=e.frameState.size,i=e.context,n=e.context.canvas.width>r[0]?f.DEVICE_PIXEL_RATIO:1,a=r[0]*n,c=r[1]*n;i.beginPath(),i.moveTo(0,0),i.lineTo(a,0),i.lineTo(a,c),i.lineTo(0,c),i.lineTo(0,0),i.closePath()},drawPrintPage:function({state:t},e){const r=e.context.canvas.width>e.mapSize[0]?f.DEVICE_PIXEL_RATIO:1,i=[e.mapSize[0]*r/2,e.mapSize[1]*r/2],n=e.printMapSize[0]/t.DOTS_PER_INCH/t.INCHES_PER_METER*e.scale/e.resolution*r,a=e.printMapSize[1]/t.DOTS_PER_INCH/t.INCHES_PER_METER*e.scale/e.resolution*r,c=i[0]-n/2,d=i[1]-a/2,P=i[0]+n/2,S=i[1]+a/2,h=(0,s.createEmpty)(),E=e.pixelToCoordinateTransform,V=(0,l.apply)(E,[c,d]),H=(0,l.apply)(E,[P,S]);e.context.moveTo(c,d),e.context.lineTo(c,S),e.context.lineTo(P,S),e.context.lineTo(P,d),e.context.lineTo(c,d),e.context.closePath(),(0,s.extendCoordinate)(h,V),(0,s.extendCoordinate)(h,H),u=h},getOptimalResolution:function({commit:t,state:e},r){const i=e.INCHES_PER_METER*e.DOTS_PER_INCH,n=r.printMapSize[0]*r.scale/(i*r.mapSize[0]),a=r.printMapSize[1]*r.scale/(i*r.mapSize[1]);t("setOptimalResolution",Math.max(n,a))},getPrintMapSize:function({state:t,commit:e,dispatch:r}){if(t.printService==="plotservice"){const i=t.currentLayout.map;e("setLayoutMapInfo",[i.width,i.height])}else{r("getAttributeInLayoutByName","map");const i=t.mapAttribute.clientInfo;e("setLayoutMapInfo",[i.width,i.height])}},getPrintMapScales:function({state:t,dispatch:e,commit:r}){var i;if(t.printService!=="plotservice"){e("getAttributeInLayoutByName","map");const n=(i=t.mapAttribute)==null?void 0:i.clientInfo;Array.isArray(n?.scales)&&r("setScaleList",n.scales.sort((a,c)=>a-c))}}}}).call(this,g(3),g(6))},3874:function(R,j,g){(function(v){var x=Object.defineProperty,I=Object.getOwnPropertyDescriptor,m=Object.getOwnPropertyNames,A=Object.prototype.hasOwnProperty,w=(o,f)=>{for(var p in f)x(o,p,{get:f[p],enumerable:!0})},z=(o,f,p,L)=>{if(f&&typeof f=="object"||typeof f=="function")for(let y of m(f))!A.call(o,y)&&y!==p&&x(o,y,{get:()=>f[y],enumerable:!(L=I(f,y))||L.enumerable});return o},N=o=>z(x({},"__esModule",{value:!0}),o),C={};w(C,{default:()=>T}),R.exports=N(C);var b=g(151),T={getCanvasLayer:function(o){const f=v.request("MapView","getOptions").resolution;let p=[],L={};if(!Array.isArray(o))return o;o.forEach(y=>{y instanceof b.Group?y.getLayers().getArray().forEach(s=>{p.push(this.buildCanvasLayerType(s,f))}):p.push(this.buildCanvasLayerType(y,f))}),p=p.reverse();for(const y of p)if(typeof y<"u"){L=y;break}return L},buildCanvasLayerType:function(o,f){const p=v.request("MapView","getCurrentExtent"),L=o.getMinResolution(),y=o.getMaxResolution(),s=this.isInScaleRange(L,y,f);let l=[],u;return s&&(o instanceof b.Image||o instanceof b.Tile||o instanceof b.VectorTile?u=o:o instanceof b.Vector&&(l=o.getSource().getFeaturesInExtent(p),l.length>0&&(u=o))),u},isInScaleRange:function(o,f,p){let L=!1;return o<=p&&f>=p&&(L=!0),L}}}).call(this,g(3))}}]);
