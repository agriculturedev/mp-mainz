(window.webpackJsonp=window.webpackJsonp||[]).push([[239,237],{3861:function(E,I,f){var w=Object.create,d=Object.defineProperty,v=Object.getOwnPropertyDescriptor,S=Object.getOwnPropertyNames,P=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty,j=(a,n)=>{for(var l in n)d(a,l,{get:n[l],enumerable:!0})},A=(a,n,l,u)=>{if(n&&typeof n=="object"||typeof n=="function")for(let h of S(n))!B.call(a,h)&&h!==l&&d(a,h,{get:()=>n[h],enumerable:!(u=v(n,h))||u.enumerable});return a},C=(a,n,l)=>(l=a!=null?w(P(a)):{},A(n||!a||!a.__esModule?d(l,"default",{value:a,enumerable:!0}):l,a)),O=a=>A(d({},"__esModule",{value:!0}),a),M={};j(M,{CommuterAnimation:()=>c}),E.exports=O(M);var F=f(40),y=f(140),L=C(f(21)),b=f(454);class c{constructor(n,l,u,h,i,t){this.featureList=n,this.speeds=l,this.layers={bubbles:u,animation:h},this.layerAnimation=h,this.ol=i,this.styles=[],this.startTime=null,this.ol.hideLayer(this.layers.animation),this.ol.clearLayer(this.layers.animation),typeof c.moveFeatureRef=="function"&&this.ol.unPostRender(this.layers.animation,c.moveFeatureRef),Array.isArray(n)&&n.length&&n.forEach((e,r)=>{const o=e.get("coordinate"),s=new L.default(new y.Point(o));s.setStyle(new F.Style({image:new F.Circle({radius:0})})),this.ol.addFeature(this.layers.animation,s),this.styles.push(t(e,r))}),this.speedsTotal=0,Array.isArray(l)&&l.forEach(e=>{this.speedsTotal+=e})}start(){this.ol.hideLayer(this.layers.bubbles),this.ol.showLayer(this.layers.animation),typeof c.moveFeatureRef=="function"&&this.ol.unPostRender(this.layers.animation,c.moveFeatureRef),c.moveFeatureRef=n=>this.moveFeature(n),this.ol.onPostRender(this.layers.animation,c.moveFeatureRef),this.startTime=new Date().getTime(),this.ol.render()}stop(){this.startTime=null,typeof c.moveFeatureRef=="function"&&(this.ol.unPostRender(this.layers.animation,c.moveFeatureRef),c.moveFeatureRef=null),this.ol.hideLayer(this.layers.animation),this.ol.showLayer(this.layers.bubbles)}isRunning(){return this.startTime!==null}moveFeature(n){const l=(0,b.getVectorContext)(n),u=n.frameState;if(this.startTime){const h=u.time-this.startTime;this.featureList.forEach((i,t)=>{const e=this.getDistance(h,this.speedsTotal,this.speeds),r=i.getGeometry().getCoordinateAt(e),o=new L.default(new y.Point(r));l.drawFeature(o,this.styles[t])}),this.ol.render()}}getDistance(n,l,u){if(!n||typeof n!="number"||!l||typeof l!="number"||!Array.isArray(u)||!u.length)return 0;const h=n%l;let i=0,t=0;for(;i>=0;){if(t+=u[i],t>h){t=u[i]-(t-h);break}i++}return i%2===0?1/u[i]*t:1-1/u[i]*t}}},3908:function(E,I,f){(function(w){var d=Object.create,v=Object.defineProperty,S=Object.getOwnPropertyDescriptor,P=Object.getOwnPropertyNames,B=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty,A=(i,t)=>{for(var e in t)v(i,e,{get:t[e],enumerable:!0})},C=(i,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of P(t))!j.call(i,o)&&o!==e&&v(i,o,{get:()=>t[o],enumerable:!(r=S(t,o))||r.enumerable});return i},O=(i,t,e)=>(e=i!=null?d(B(i)):{},C(t||!i||!i.__esModule?v(e,"default",{value:i,enumerable:!0}):e,i)),M=i=>C(v({},"__esModule",{value:!0}),i),F={};A(F,{CommuterOL:()=>h}),E.exports=M(F);var y=f(40),L=f(5),b=O(f(48)),c=f(140),a=O(f(21)),n=O(f(121)),l=O(f(284)),u=f(3861);class h{constructor(t,e=null){this.options=Object.assign({font:"10pt sans-serif",fontShadow:{color:[255,255,255,.9],width:5},beam:{width:3},bubblePixelMax:50,bubblePixelMin:20,bubbleBorder:{color:[60,60,60,1],width:.5},bubbleColors:[[230,159,0,.75],[86,180,233,.75],[0,158,115,.75],[240,228,66,.75],[0,114,178,.75],[213,94,0,.75],[204,121,167,.75]],bubbleColorShift:[0,-60,60],zoomOptions:{padding:[20,20,20,400]},animationPaces:[6e3,300]},t),this.ol=Object.assign(this.getOpenlayersConnectors(),e),this.layers={beams:null,bubbles:null,animation:null,captions:null},this.ol.createLayerIfNotExists("CommuterOL_layerBeams",r=>{this.layers.beams=r}),this.ol.createLayerIfNotExists("CommuterOL_layerBubbles",r=>{this.layers.bubbles=r}),this.ol.createLayerIfNotExists("CommuterOL_layerAnimation",r=>{this.layers.animation=r}),this.ol.createLayerIfNotExists("CommuterOL_layerCaptions",r=>{this.layers.captions=r}),this.animation=null}getOpenlayersConnectors(){return{createLayerIfNotExists:(t,e)=>{const r=w.request("Map","createLayerIfNotExists",t);r instanceof b.default?e(r):r instanceof Promise&&r.then(o=>{e(o)})},getFeatures:t=>t instanceof b.default?t.getSource().getFeatures():null,addFeature:(t,e)=>{t instanceof b.default&&e instanceof a.default&&t.getSource().addFeature(e)},clearLayer:t=>{t instanceof b.default&&t.getSource().clear()},zoomToExtent:t=>{w.trigger("Map","zoomToExtent",{extent:t,options:this.options.zoomOptions})},showLayer:t=>{t instanceof b.default&&t.setVisible(!0)},hideLayer:t=>{t instanceof b.default&&t.setVisible(!1)},render:()=>{w.trigger("Map","render")},onPostRender:(t,e)=>{t instanceof b.default&&typeof e=="function"&&t.on("postrender",e)},unPostRender:(t,e)=>{t instanceof b.default&&typeof e=="function"&&t.un("postrender",e)},expandExtent:(t,e)=>(0,L.extend)(t,e)}}clearLayers(){this.removeCaptions(),this.removeBeams(),this.removeAnimation()}addCaptions(t,e,r,o=!0,s=!0){if(this.removeCaptions(),!o&&!s)return;const p=`
`;o&&this.ol.addFeature(this.layers.captions,this.getFeatureCaption(t,e)),r.forEach(g=>{let m="";o&&(m+=g.get("caption")+p),s&&(m+=(0,l.default)(g.get("value"))+p),o&&s&&(m+=p),this.ol.addFeature(this.layers.captions,this.getFeatureCaption(m+p,g.get("coordinate")))})}removeCaptions(){this.ol.clearLayer(this.layers.captions)}addBeams(t){this.removeBeams(),!(!Array.isArray(t)||!t.length)&&t.forEach((e,r)=>{this.ol.addFeature(this.layers.beams,this.getFeatureBeam(e,r))})}removeBeams(){this.ol.clearLayer(this.layers.beams)}initAnimation(t,e,r="area"){if(this.removeAnimation(),!Array.isArray(t)||!t.length)return;const o=this.getRadiusAlgorithm(r);t.forEach((s,p)=>{const g=o(s.get("value"),e,this.options.bubblePixelMax,this.options.bubblePixelMin),m=this.getColor(p),T=this.getFeatureBubble(s,g,m);this.ol.addFeature(this.layers.bubbles,T)}),this.animation=new u.CommuterAnimation(t,this.options.animationPaces,this.layers.bubbles,this.layers.animation,this.ol,(s,p)=>{const g=o(s.get("value"),e,this.options.bubblePixelMax,this.options.bubblePixelMin),m=this.getColor(p);return this.getBubbleStyle(g,m,this.options.bubbleBorder)})}startAnimation(){this.animation instanceof u.CommuterAnimation&&this.animation.start()}stopAnimation(){this.animation instanceof u.CommuterAnimation&&this.animation.stop()}isAnimationRunning(){return this.animation instanceof u.CommuterAnimation&&this.animation.isRunning()}removeAnimation(){this.stopAnimation(),this.animation=null,this.ol.clearLayer(this.layers.bubbles),this.ol.clearLayer(this.layers.animation)}zoomToExtent(t){const e=this.getExtentOfFeatures(t);this.ol.zoomToExtent(e)}getColor(t){return this.getBubbleColor(t,this.options.bubbleColors,this.options.bubbleColorShift)}getFeatureCaption(t,e){const r=new c.Point(e),o=new a.default(r);return o.set("styleId",(0,n.default)("CommuterOL")),o.setStyle(new y.Style({text:new y.Text({text:t,font:this.options.font,placement:"point",stroke:new y.Stroke(this.options.fontShadow)})})),o}getFeatureBeam(t,e){const r=new a.default({geometry:t.getGeometry()}),o=Object.assign({color:this.getColor(e)},this.options.beam);return r.set("styleId",(0,n.default)("CommuterOL")),r.setStyle(new y.Style({stroke:new y.Stroke(o)})),r}getFeatureBubble(t,e,r){const o=t.get("coordinate"),s=new a.default(new c.Point(o));return s.set("styleId",(0,n.default)("CommuterOL")),s.setStyle(this.getBubbleStyle(e,r,this.options.bubbleBorder)),s}getBubbleStyle(t,e,r){return new y.Style({image:new y.Circle({radius:t,fill:new y.Fill({color:e}),stroke:new y.Stroke(r)})})}getExtentOfFeatures(t){if(!Array.isArray(t)||!t.length)return[];let e=null;return t.forEach(r=>{if(!(r instanceof a.default))return;const o=r.getGeometry().getExtent();if(!e){e=o;return}this.ol.expandExtent(e,o)}),e}getBubbleColor(t,e,r){if(typeof t!="number"||t<0)return[0,0,0,1];if(!Array.isArray(e)||!Array.isArray(r)||!e.length||!r.length)return[0,0,0,1];const o=e[t%e.length],s=r[Math.floor(t/e.length)%r.length];return!Array.isArray(o)||o.length!==4?[0,0,0,1]:typeof s!="number"?o:[Math.min(255,Math.max(0,o[0]+s)),Math.min(255,Math.max(0,o[1]+s)),Math.min(255,Math.max(0,o[2]+s)),Math.min(1,Math.max(0,o[3]))]}getRadiusAlgorithm(t){switch(t){case"area":return this.calcRadiusArea;case"linear":return this.calcRadiusLinear;case"log":return this.calcRadiusLog10;default:return this.calcRadiusArea}}calcRadiusArea(t,e,r){if(typeof t!="number"||typeof e!="number"||typeof r!="number")return 0;if(t<=0||e<=0||r<=0)return 0;if(t>=e)return r;const o=Math.sqrt(e/Math.PI),s=Math.sqrt(t/Math.PI);return r/o*s}calcRadiusLinear(t,e,r,o=0){return typeof o!="number"?0:typeof t!="number"||typeof e!="number"||typeof r!="number"||r<=o||t<=0||e<=0?o:t>=e?r:(r-o)/e*t+o}calcRadiusLog10(t,e,r,o=0){return typeof o!="number"?0:typeof t!="number"||typeof e!="number"||typeof r!="number"||r<=o||t<=0||e<=0?o:t>=e?r:(r-o)/Math.log10(e)*Math.log10(t)+o}}}).call(this,f(3))}}]);
